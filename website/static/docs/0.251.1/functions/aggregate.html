
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="374665">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  <script>
      window.ga = window.ga || function () {
          (ga.q = ga.q || []).push(arguments)
      };
      ga.l = +new Date;
      ga('create', 'UA-82811140-44', 'auto');
      ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  
  
    <title>Aggregate Functions &#8212; Presto 0.251.1 Documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/material.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/presto.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Window Functions" href="window.html" />
    <link rel="prev" title="Date and Time Functions and Operators" href="datetime.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=grey data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#functions/aggregate" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Presto 0.251.1 Documentation"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/logo.png" height="26"
                   alt="Presto 0.251.1 Documentation logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Presto 0.251.1 Documentation</span>
          <span class="md-header-nav__topic"> Aggregate Functions </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    <!-- empty -->
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Presto 0.251.1 Documentation" class="md-nav__button md-logo">
      
        <img src="../_static/logo.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Presto 0.251.1 Documentation">Presto 0.251.1 Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../cache.html" class="md-nav__link">Cache</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query Optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and Operators</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="logical.html" class="md-nav__link">Logical Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="comparison.html" class="md-nav__link">Comparison Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="conditional.html" class="md-nav__link">Conditional Expressions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="lambda.html" class="md-nav__link">Lambda Expressions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="conversion.html" class="md-nav__link">Conversion Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="math.html" class="md-nav__link">Mathematical Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="bitwise.html" class="md-nav__link">Bitwise Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="decimal.html" class="md-nav__link">Decimal Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="string.html" class="md-nav__link">String Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="regexp.html" class="md-nav__link">Regular Expression Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="binary.html" class="md-nav__link">Binary Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="json.html" class="md-nav__link">JSON Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="datetime.html" class="md-nav__link">Date and Time Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Aggregate Functions </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Aggregate Functions</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#functions-aggregate--page-root" class="md-nav__link">Aggregate Functions</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#general-aggregate-functions" class="md-nav__link">General Aggregate Functions</a>
        </li>
        <li class="md-nav__item"><a href="#bitwise-aggregate-functions" class="md-nav__link">Bitwise Aggregate Functions</a>
        </li>
        <li class="md-nav__item"><a href="#map-aggregate-functions" class="md-nav__link">Map Aggregate Functions</a>
        </li>
        <li class="md-nav__item"><a href="#approximate-aggregate-functions" class="md-nav__link">Approximate Aggregate Functions</a>
        </li>
        <li class="md-nav__item"><a href="#statistical-aggregate-functions" class="md-nav__link">Statistical Aggregate Functions</a>
        </li>
        <li class="md-nav__item"><a href="#classification-metrics-aggregate-functions" class="md-nav__link">Classification Metrics Aggregate Functions</a>
        </li>
        <li class="md-nav__item"><a href="#differential-entropy-functions" class="md-nav__link">Differential Entropy Functions</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="window.html" class="md-nav__link">Window Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="array.html" class="md-nav__link">Array Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="map.html" class="md-nav__link">Map Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="url.html" class="md-nav__link">URL Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ip.html" class="md-nav__link">IP Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="geospatial.html" class="md-nav__link">Geospatial Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hyperloglog.html" class="md-nav__link">HyperLogLog Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="khyperloglog.html" class="md-nav__link">KHyperLogLog Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="qdigest.html" class="md-nav__link">Quantile Digest Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="color.html" class="md-nav__link">Color Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="session.html" class="md-nav__link">Session Information</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="teradata.html" class="md-nav__link">Teradata Functions</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="internationalization.html" class="md-nav__link">Internationalization Functions</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL Language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL Statement Syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../migration.html" class="md-nav__link">Migration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release Notes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#functions-aggregate--page-root" class="md-nav__link">Aggregate Functions</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#general-aggregate-functions" class="md-nav__link">General Aggregate Functions</a>
        </li>
        <li class="md-nav__item"><a href="#bitwise-aggregate-functions" class="md-nav__link">Bitwise Aggregate Functions</a>
        </li>
        <li class="md-nav__item"><a href="#map-aggregate-functions" class="md-nav__link">Map Aggregate Functions</a>
        </li>
        <li class="md-nav__item"><a href="#approximate-aggregate-functions" class="md-nav__link">Approximate Aggregate Functions</a>
        </li>
        <li class="md-nav__item"><a href="#statistical-aggregate-functions" class="md-nav__link">Statistical Aggregate Functions</a>
        </li>
        <li class="md-nav__item"><a href="#classification-metrics-aggregate-functions" class="md-nav__link">Classification Metrics Aggregate Functions</a>
        </li>
        <li class="md-nav__item"><a href="#differential-entropy-functions" class="md-nav__link">Differential Entropy Functions</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="aggregate-functions">
<h1 id="functions-aggregate--page-root">Aggregate Functions<a class="headerlink" href="#functions-aggregate--page-root" title="Permalink to this headline">#</a></h1>
<p>Aggregate functions operate on a set of values to compute a single result.</p>
<p>Except for <a class="reference internal" href="#id1" title="count"><code class="xref py py-func docutils literal notranslate"><span class="pre">count()</span></code></a>, <a class="reference internal" href="#count_if" title="count_if"><code class="xref py py-func docutils literal notranslate"><span class="pre">count_if()</span></code></a>, <a class="reference internal" href="#id2" title="max_by"><code class="xref py py-func docutils literal notranslate"><span class="pre">max_by()</span></code></a>, <a class="reference internal" href="#id3" title="min_by"><code class="xref py py-func docutils literal notranslate"><span class="pre">min_by()</span></code></a> and
<a class="reference internal" href="#id6" title="approx_distinct"><code class="xref py py-func docutils literal notranslate"><span class="pre">approx_distinct()</span></code></a>, all of these aggregate functions ignore null values
and return null for no input rows or when all values are null. For example,
<a class="reference internal" href="#sum" title="sum"><code class="xref py py-func docutils literal notranslate"><span class="pre">sum()</span></code></a> returns null rather than zero and <a class="reference internal" href="#id0" title="avg"><code class="xref py py-func docutils literal notranslate"><span class="pre">avg()</span></code></a> does not include null
values in the count. The <code class="docutils literal notranslate"><span class="pre">coalesce</span></code> function can be used to convert null into
zero.</p>
<p>Some aggregate functions such as <a class="reference internal" href="#array_agg" title="array_agg"><code class="xref py py-func docutils literal notranslate"><span class="pre">array_agg()</span></code></a> produce different results
depending on the order of input values. This ordering can be specified by writing
an <a class="reference internal" href="../sql/select.html#order-by-clause"><span class="std std-ref">ORDER BY Clause</span></a> within the aggregate function:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">array_agg</span><span class="p">(</span><span class="n">x</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">y</span> <span class="k">DESC</span><span class="p">)</span>
<span class="n">array_agg</span><span class="p">(</span><span class="n">x</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
<section id="general-aggregate-functions">
<h2 id="general-aggregate-functions">General Aggregate Functions<a class="headerlink" href="#general-aggregate-functions" title="Permalink to this headline">#</a></h2>
<dl class="py function">
<dt id="arbitrary">
<code class="sig-name descname">arbitrary</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → [same as input]<a class="headerlink" href="#arbitrary" title="Permalink to this definition">#</a></dt>
<dd><p>Returns an arbitrary non-null value of <code class="docutils literal notranslate"><span class="pre">x</span></code>, if one exists.</p>
</dd></dl>
<dl class="py function">
<dt id="array_agg">
<code class="sig-name descname">array_agg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → array&lt;[same as input]&gt;<a class="headerlink" href="#array_agg" title="Permalink to this definition">#</a></dt>
<dd><p>Returns an array created from the input <code class="docutils literal notranslate"><span class="pre">x</span></code> elements.</p>
</dd></dl>
<dl class="py function">
<dt id="avg">
<code class="sig-name descname">avg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#avg" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the average (arithmetic mean) of all input values.</p>
</dd></dl>
<dl class="py function">
<dt id="id0">
<code class="sig-name descname">avg</code><span class="sig-paren">(</span><em class="sig-param">time interval type</em><span class="sig-paren">)</span> → time interval type<a class="headerlink" href="#id0" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the average interval length of all input values.</p>
</dd></dl>
<dl class="py function">
<dt id="bool_and">
<code class="sig-name descname">bool_and</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">boolean</span></em><span class="sig-paren">)</span> → boolean<a class="headerlink" href="#bool_and" title="Permalink to this definition">#</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> if every input value is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, otherwise <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="bool_or">
<code class="sig-name descname">bool_or</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">boolean</span></em><span class="sig-paren">)</span> → boolean<a class="headerlink" href="#bool_or" title="Permalink to this definition">#</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> if any input value is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, otherwise <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="checksum">
<code class="sig-name descname">checksum</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → varbinary<a class="headerlink" href="#checksum" title="Permalink to this definition">#</a></dt>
<dd><p>Returns an order-insensitive checksum of the given values.</p>
</dd></dl>
<dl class="py function">
<dt id="count">
<code class="sig-name descname">count</code><span class="sig-paren">(</span><em class="sig-param">*</em><span class="sig-paren">)</span> → bigint<a class="headerlink" href="#count" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the number of input rows.</p>
</dd></dl>
<dl class="py function">
<dt id="id1">
<code class="sig-name descname">count</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → bigint<a class="headerlink" href="#id1" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the number of non-null input values.</p>
</dd></dl>
<dl class="py function">
<dt id="count_if">
<code class="sig-name descname">count_if</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → bigint<a class="headerlink" href="#count_if" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the number of <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> input values.
This function is equivalent to <code class="docutils literal notranslate"><span class="pre">count(CASE</span> <span class="pre">WHEN</span> <span class="pre">x</span> <span class="pre">THEN</span> <span class="pre">1</span> <span class="pre">END)</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="every">
<code class="sig-name descname">every</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">boolean</span></em><span class="sig-paren">)</span> → boolean<a class="headerlink" href="#every" title="Permalink to this definition">#</a></dt>
<dd><p>This is an alias for <a class="reference internal" href="#bool_and" title="bool_and"><code class="xref py py-func docutils literal notranslate"><span class="pre">bool_and()</span></code></a>.</p>
</dd></dl>
<dl class="py function">
<dt id="geometric_mean">
<code class="sig-name descname">geometric_mean</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#geometric_mean" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the geometric mean of all input values.</p>
</dd></dl>
<dl class="py function">
<dt id="max_by">
<code class="sig-name descname">max_by</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">y</span></em><span class="sig-paren">)</span> → [same as x]<a class="headerlink" href="#max_by" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the value of <code class="docutils literal notranslate"><span class="pre">x</span></code> associated with the maximum value of <code class="docutils literal notranslate"><span class="pre">y</span></code> over all input values.</p>
</dd></dl>
<dl class="py function">
<dt id="id2">
<code class="sig-name descname">max_by</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">n</span></em><span class="sig-paren">)</span> → array&lt;[same as x]&gt;<a class="headerlink" href="#id2" title="Permalink to this definition">#</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">n</span></code> values of <code class="docutils literal notranslate"><span class="pre">x</span></code> associated with the <code class="docutils literal notranslate"><span class="pre">n</span></code> largest of all input values of <code class="docutils literal notranslate"><span class="pre">y</span></code>
in descending order of <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="min_by">
<code class="sig-name descname">min_by</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">y</span></em><span class="sig-paren">)</span> → [same as x]<a class="headerlink" href="#min_by" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the value of <code class="docutils literal notranslate"><span class="pre">x</span></code> associated with the minimum value of <code class="docutils literal notranslate"><span class="pre">y</span></code> over all input values.</p>
</dd></dl>
<dl class="py function">
<dt id="id3">
<code class="sig-name descname">min_by</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">n</span></em><span class="sig-paren">)</span> → array&lt;[same as x]&gt;<a class="headerlink" href="#id3" title="Permalink to this definition">#</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">n</span></code> values of <code class="docutils literal notranslate"><span class="pre">x</span></code> associated with the <code class="docutils literal notranslate"><span class="pre">n</span></code> smallest of all input values of <code class="docutils literal notranslate"><span class="pre">y</span></code>
in ascending order of <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="max">
<code class="sig-name descname">max</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → [same as input]<a class="headerlink" href="#max" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the maximum value of all input values.</p>
</dd></dl>
<dl class="py function">
<dt id="id4">
<code class="sig-name descname">max</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">n</span></em><span class="sig-paren">)</span> → array&lt;[same as x]&gt;<a class="headerlink" href="#id4" title="Permalink to this definition">#</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">n</span></code> largest values of all input values of <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="min">
<code class="sig-name descname">min</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → [same as input]<a class="headerlink" href="#min" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the minimum value of all input values.</p>
</dd></dl>
<dl class="py function">
<dt id="id5">
<code class="sig-name descname">min</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">n</span></em><span class="sig-paren">)</span> → array&lt;[same as x]&gt;<a class="headerlink" href="#id5" title="Permalink to this definition">#</a></dt>
<dd><p>Returns <code class="docutils literal notranslate"><span class="pre">n</span></code> smallest values of all input values of <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="reduce_agg">
<code class="sig-name descname">reduce_agg</code><span class="sig-paren">(</span><em class="sig-param">inputValue T</em>, <em class="sig-param">initialState S</em>, <em class="sig-param">inputFunction(S</em>, <em class="sig-param">T</em>, <em class="sig-param">S)</em>, <em class="sig-param">combineFunction(S</em>, <em class="sig-param">S</em>, <em class="sig-param">S)</em><span class="sig-paren">)</span> → S<a class="headerlink" href="#reduce_agg" title="Permalink to this definition">#</a></dt>
<dd><p>Reduces all input values into a single value. <code class="docutils literal notranslate"><span class="pre">`inputFunction</span></code> will be invoked
for each input value. In addition to taking the input value, <code class="docutils literal notranslate"><span class="pre">inputFunction</span></code>
takes the current state, initially <code class="docutils literal notranslate"><span class="pre">initialState</span></code>, and returns the new state.
<code class="docutils literal notranslate"><span class="pre">combineFunction</span></code> will be invoked to combine two states into a new state.
The final state is returned:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">reduce_agg</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
<span class="k">FROM</span> <span class="p">(</span>
    <span class="k">VALUES</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="p">)</span> <span class="k">AS</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">id</span><span class="p">;</span>
<span class="c1">-- (1, 9)</span>
<span class="c1">-- (2, 90)</span>

<span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">reduce_agg</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
<span class="k">FROM</span> <span class="p">(</span>
    <span class="k">VALUES</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="p">)</span> <span class="k">AS</span> <span class="n">t</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">id</span><span class="p">;</span>
<span class="c1">-- (1, 24)</span>
<span class="c1">-- (2, 24000)</span>
</pre></div>
</div>
<p>The state type must be a boolean, integer, floating-point, or date/time/interval.</p>
</dd></dl>
<dl class="py function">
<dt id="set_agg">
<code class="sig-name descname">set_agg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → array&lt;[same as input]&gt;<a class="headerlink" href="#set_agg" title="Permalink to this definition">#</a></dt>
<dd><p>Returns an array created from the distinct input <code class="docutils literal notranslate"><span class="pre">x</span></code> elements.</p>
</dd></dl>
<dl class="py function">
<dt id="set_union">
<code class="sig-name descname">set_union</code><span class="sig-paren">(</span><em class="sig-param">array(T)) -&gt; array(T</em><span class="sig-paren">)</span><a class="headerlink" href="#set_union" title="Permalink to this definition">#</a></dt>
<dd><p>Returns an array of all the distinct values contained in each array of the input</p>
<p>Example:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">set_union</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
<span class="k">FROM</span> <span class="p">(</span>
    <span class="k">VALUES</span>
        <span class="nb">ARRAY</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="nb">ARRAY</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="p">)</span> <span class="k">AS</span> <span class="n">t</span><span class="p">(</span><span class="n">elements</span><span class="p">);</span>
</pre></div>
</div>
<p>Returns ARRAY[1, 2, 3, 4]</p>
</dd></dl>
<dl class="py function">
<dt id="sum">
<code class="sig-name descname">sum</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → [same as input]<a class="headerlink" href="#sum" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the sum of all input values.</p>
</dd></dl>
</section>
<section id="bitwise-aggregate-functions">
<h2 id="bitwise-aggregate-functions">Bitwise Aggregate Functions<a class="headerlink" href="#bitwise-aggregate-functions" title="Permalink to this headline">#</a></h2>
<dl class="py function">
<dt id="bitwise_and_agg">
<code class="sig-name descname">bitwise_and_agg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → bigint<a class="headerlink" href="#bitwise_and_agg" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the bitwise AND of all input values in 2’s complement representation.</p>
</dd></dl>
<dl class="py function">
<dt id="bitwise_or_agg">
<code class="sig-name descname">bitwise_or_agg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → bigint<a class="headerlink" href="#bitwise_or_agg" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the bitwise OR of all input values in 2’s complement representation.</p>
</dd></dl>
</section>
<section id="map-aggregate-functions">
<h2 id="map-aggregate-functions">Map Aggregate Functions<a class="headerlink" href="#map-aggregate-functions" title="Permalink to this headline">#</a></h2>
<dl class="py function">
<dt id="histogram">
<code class="sig-name descname">histogram</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="headerlink" href="#histogram" title="Permalink to this definition">#</a></dt>
<dd><p>Returns a map containing the count of the number of times each input value occurs.</p>
</dd></dl>
<dl class="py function">
<dt id="map_agg">
<code class="sig-name descname">map_agg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em>, <em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#map_agg" title="Permalink to this definition">#</a></dt>
<dd><p>Returns a map created from the input <code class="docutils literal notranslate"><span class="pre">key</span></code> / <code class="docutils literal notranslate"><span class="pre">value</span></code> pairs.</p>
</dd></dl>
<dl class="py function">
<dt id="map_union">
<code class="sig-name descname">map_union</code><span class="sig-paren">(</span><em class="sig-param">x(K</em>, <em class="sig-param">V)) -&gt; map(K</em>, <em class="sig-param">V</em><span class="sig-paren">)</span><a class="headerlink" href="#map_union" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the union of all the input maps. If a key is found in multiple
input maps, that key’s value in the resulting map comes from an arbitrary input map.</p>
</dd></dl>
<dl class="py function">
<dt id="map_union_sum">
<code class="sig-name descname">map_union_sum</code><span class="sig-paren">(</span><em class="sig-param">x(K</em>, <em class="sig-param">V)) -&gt; map(K</em>, <em class="sig-param">V</em><span class="sig-paren">)</span><a class="headerlink" href="#map_union_sum" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the union of all the input maps summing the values of matching keys in all
the maps. All null values in the original maps are coalesced to 0.</p>
</dd></dl>
<dl class="py function">
<dt id="multimap_agg">
<code class="sig-name descname">multimap_agg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em>, <em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#multimap_agg" title="Permalink to this definition">#</a></dt>
<dd><p>Returns a multimap created from the input <code class="docutils literal notranslate"><span class="pre">key</span></code> / <code class="docutils literal notranslate"><span class="pre">value</span></code> pairs.
Each key can be associated with multiple values.</p>
</dd></dl>
</section>
<section id="approximate-aggregate-functions">
<h2 id="approximate-aggregate-functions">Approximate Aggregate Functions<a class="headerlink" href="#approximate-aggregate-functions" title="Permalink to this headline">#</a></h2>
<dl class="py function">
<dt id="approx_distinct">
<code class="sig-name descname">approx_distinct</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → bigint<a class="headerlink" href="#approx_distinct" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the approximate number of distinct input values.
This function provides an approximation of <code class="docutils literal notranslate"><span class="pre">count(DISTINCT</span> <span class="pre">x)</span></code>.
Zero is returned if all input values are null.</p>
<p>This function should produce a standard error of 2.3%, which is the
standard deviation of the (approximately normal) error distribution over
all possible sets. It does not guarantee an upper bound on the error for
any specific input set.</p>
</dd></dl>
<dl class="py function">
<dt id="id6">
<code class="sig-name descname">approx_distinct</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">e</span></em><span class="sig-paren">)</span> → bigint<a class="headerlink" href="#id6" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the approximate number of distinct input values.
This function provides an approximation of <code class="docutils literal notranslate"><span class="pre">count(DISTINCT</span> <span class="pre">x)</span></code>.
Zero is returned if all input values are null.</p>
<p>This function should produce a standard error of no more than <code class="docutils literal notranslate"><span class="pre">e</span></code>, which
is the standard deviation of the (approximately normal) error distribution
over all possible sets. It does not guarantee an upper bound on the error
for any specific input set. The current implementation of this function
requires that <code class="docutils literal notranslate"><span class="pre">e</span></code> be in the range of <code class="docutils literal notranslate"><span class="pre">[0.0040625,</span> <span class="pre">0.26000]</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="approx_percentile">
<code class="sig-name descname">approx_percentile</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">percentage</span></em><span class="sig-paren">)</span> → [same as x]<a class="headerlink" href="#approx_percentile" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the approximate percentile for all input values of <code class="docutils literal notranslate"><span class="pre">x</span></code> at the
given <code class="docutils literal notranslate"><span class="pre">percentage</span></code>. The value of <code class="docutils literal notranslate"><span class="pre">percentage</span></code> must be between zero and
one and must be constant for all input rows.</p>
</dd></dl>
<dl class="py function">
<dt id="id7">
<code class="sig-name descname">approx_percentile</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">percentage</span></em>, <em class="sig-param"><span class="n">accuracy</span></em><span class="sig-paren">)</span> → [same as x]<a class="headerlink" href="#id7" title="Permalink to this definition">#</a></dt>
<dd><p>As <code class="docutils literal notranslate"><span class="pre">approx_percentile(x,</span> <span class="pre">percentage)</span></code>, but with a maximum rank error of
<code class="docutils literal notranslate"><span class="pre">accuracy</span></code>. The value of <code class="docutils literal notranslate"><span class="pre">accuracy</span></code> must be between zero and one
(exclusive) and must be constant for all input rows. Note that a lower
“accuracy” is really a lower error threshold, and thus more accurate. The
default accuracy is <code class="docutils literal notranslate"><span class="pre">0.01</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="id8">
<code class="sig-name descname">approx_percentile</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">percentages</span></em><span class="sig-paren">)</span> → array&lt;[same as x]&gt;<a class="headerlink" href="#id8" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the approximate percentile for all input values of <code class="docutils literal notranslate"><span class="pre">x</span></code> at each of
the specified percentages. Each element of the <code class="docutils literal notranslate"><span class="pre">percentages</span></code> array must be
between zero and one, and the array must be constant for all input rows.</p>
</dd></dl>
<dl class="py function">
<dt id="id9">
<code class="sig-name descname">approx_percentile</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">percentages</span></em>, <em class="sig-param"><span class="n">accuracy</span></em><span class="sig-paren">)</span> → array&lt;[same as x]&gt;<a class="headerlink" href="#id9" title="Permalink to this definition">#</a></dt>
<dd><p>As <code class="docutils literal notranslate"><span class="pre">approx_percentile(x,</span> <span class="pre">percentages)</span></code>, but with a maximum rank error of
<code class="docutils literal notranslate"><span class="pre">accuracy</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="id10">
<code class="sig-name descname">approx_percentile</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">w</span></em>, <em class="sig-param"><span class="n">percentage</span></em><span class="sig-paren">)</span> → [same as x]<a class="headerlink" href="#id10" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the approximate weighed percentile for all input values of <code class="docutils literal notranslate"><span class="pre">x</span></code>
using the per-item weight <code class="docutils literal notranslate"><span class="pre">w</span></code> at the percentage <code class="docutils literal notranslate"><span class="pre">p</span></code>. The weight must be
an integer value of at least one. It is effectively a replication count for
the value <code class="docutils literal notranslate"><span class="pre">x</span></code> in the percentile set. The value of <code class="docutils literal notranslate"><span class="pre">p</span></code> must be between
zero and one and must be constant for all input rows.</p>
</dd></dl>
<dl class="py function">
<dt id="id11">
<code class="sig-name descname">approx_percentile</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">w</span></em>, <em class="sig-param"><span class="n">percentage</span></em>, <em class="sig-param"><span class="n">accuracy</span></em><span class="sig-paren">)</span> → [same as x]<a class="headerlink" href="#id11" title="Permalink to this definition">#</a></dt>
<dd><p>As <code class="docutils literal notranslate"><span class="pre">approx_percentile(x,</span> <span class="pre">w,</span> <span class="pre">percentage)</span></code>, but with a maximum rank error of
<code class="docutils literal notranslate"><span class="pre">accuracy</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="id12">
<code class="sig-name descname">approx_percentile</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">w</span></em>, <em class="sig-param"><span class="n">percentages</span></em><span class="sig-paren">)</span> → array&lt;[same as x]&gt;<a class="headerlink" href="#id12" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the approximate weighed percentile for all input values of <code class="docutils literal notranslate"><span class="pre">x</span></code>
using the per-item weight <code class="docutils literal notranslate"><span class="pre">w</span></code> at each of the given percentages specified
in the array. The weight must be an integer value of at least one. It is
effectively a replication count for the value <code class="docutils literal notranslate"><span class="pre">x</span></code> in the percentile set.
Each element of the array must be between zero and one, and the array must
be constant for all input rows.</p>
</dd></dl>
<dl class="py function">
<dt id="id13">
<code class="sig-name descname">approx_percentile</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">w</span></em>, <em class="sig-param"><span class="n">percentages</span></em>, <em class="sig-param"><span class="n">accuracy</span></em><span class="sig-paren">)</span> → array&lt;[same as x]&gt;<a class="headerlink" href="#id13" title="Permalink to this definition">#</a></dt>
<dd><p>As <code class="docutils literal notranslate"><span class="pre">approx_percentile(x,</span> <span class="pre">w,</span> <span class="pre">percentages)</span></code>, but with a maximum rank error of
<code class="docutils literal notranslate"><span class="pre">accuracy</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt>
<code class="sig-name descname">approx_set</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → HyperLogLog</dt>
<dd><p>See <a class="reference internal" href="hyperloglog.html"><span class="doc">HyperLogLog Functions</span></a>.</p>
</dd></dl>
<dl class="py function">
<dt>
<code class="sig-name descname">merge</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → HyperLogLog</dt>
<dd><p>See <a class="reference internal" href="hyperloglog.html"><span class="doc">HyperLogLog Functions</span></a>.</p>
</dd></dl>
<dl class="py function">
<dt>
<code class="sig-name descname">khyperloglog_agg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → KHyperLogLog</dt>
<dd><p>See <a class="reference internal" href="khyperloglog.html"><span class="doc">KHyperLogLog Functions</span></a>.</p>
</dd></dl>
<dl class="py function">
<dt>
<code class="sig-name descname">merge</code><span class="sig-paren">(</span><em class="sig-param">qdigest(T)) -&gt; qdigest(T</em><span class="sig-paren">)</span></dt>
<dd><p>See <a class="reference internal" href="qdigest.html"><span class="doc">Quantile Digest Functions</span></a>.</p>
</dd></dl>
<dl class="py function">
<dt>
<code class="sig-name descname">qdigest_agg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → qdigest&lt;[same as x]&gt;</dt>
<dd><p>See <a class="reference internal" href="qdigest.html"><span class="doc">Quantile Digest Functions</span></a>.</p>
</dd></dl>
<dl class="py function">
<dt>
<code class="sig-name descname">qdigest_agg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">w</span></em><span class="sig-paren">)</span> → qdigest&lt;[same as x]&gt;</dt>
<dd><p>See <a class="reference internal" href="qdigest.html"><span class="doc">Quantile Digest Functions</span></a>.</p>
</dd></dl>
<dl class="py function">
<dt>
<code class="sig-name descname">qdigest_agg</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">w</span></em>, <em class="sig-param"><span class="n">accuracy</span></em><span class="sig-paren">)</span> → qdigest&lt;[same as x]&gt;</dt>
<dd><p>See <a class="reference internal" href="qdigest.html"><span class="doc">Quantile Digest Functions</span></a>.</p>
</dd></dl>
<dl class="py function">
<dt id="numeric_histogram">
<code class="sig-name descname">numeric_histogram</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">buckets</span></em>, <em class="sig-param"><span class="n">value</span></em>, <em class="sig-param"><span class="n">weight</span></em><span class="sig-paren">)</span> → map&lt;double, double&gt;<a class="headerlink" href="#numeric_histogram" title="Permalink to this definition">#</a></dt>
<dd><p>Computes an approximate histogram with up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> number of buckets
for all <code class="docutils literal notranslate"><span class="pre">value</span></code>s with a per-item weight of <code class="docutils literal notranslate"><span class="pre">weight</span></code>.  The keys of the
returned map are roughly the center of the bin, and the entry is the total
weight of the bin.  The algorithm is based loosely on <a class="reference internal" href="#benhaimtomtov2010" id="id14"><span>[BenHaimTomTov2010]</span></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">buckets</span></code> must be a <code class="docutils literal notranslate"><span class="pre">bigint</span></code>. <code class="docutils literal notranslate"><span class="pre">value</span></code> and <code class="docutils literal notranslate"><span class="pre">weight</span></code> must be numeric.</p>
</dd></dl>
<dl class="py function">
<dt id="id15">
<code class="sig-name descname">numeric_histogram</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">buckets</span></em>, <em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span> → map&lt;double, double&gt;<a class="headerlink" href="#id15" title="Permalink to this definition">#</a></dt>
<dd><p>Computes an approximate histogram with up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> number of buckets
for all <code class="docutils literal notranslate"><span class="pre">value</span></code>s. This function is equivalent to the variant of
<a class="reference internal" href="#id15" title="numeric_histogram"><code class="xref py py-func docutils literal notranslate"><span class="pre">numeric_histogram()</span></code></a> that takes a <code class="docutils literal notranslate"><span class="pre">weight</span></code>, with a per-item weight of <code class="docutils literal notranslate"><span class="pre">1</span></code>.
In this case, the total weight in the returned map is the count of items in the bin.</p>
</dd></dl>
</section>
<section id="statistical-aggregate-functions">
<h2 id="statistical-aggregate-functions">Statistical Aggregate Functions<a class="headerlink" href="#statistical-aggregate-functions" title="Permalink to this headline">#</a></h2>
<dl class="py function">
<dt id="corr">
<code class="sig-name descname">corr</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#corr" title="Permalink to this definition">#</a></dt>
<dd><p>Returns correlation coefficient of input values.</p>
</dd></dl>
<dl class="py function">
<dt id="covar_pop">
<code class="sig-name descname">covar_pop</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#covar_pop" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the population covariance of input values.</p>
</dd></dl>
<dl class="py function">
<dt id="covar_samp">
<code class="sig-name descname">covar_samp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#covar_samp" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the sample covariance of input values.</p>
</dd></dl>
<dl class="py function">
<dt id="entropy">
<code class="sig-name descname">entropy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">c</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#entropy" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the log-2 entropy of count input-values.</p>
<div class="math notranslate nohighlight">
\[\mathrm{entropy}(c) = \sum_i \left[ {c_i \over \sum_j [c_j]} \log_2\left({\sum_j [c_j] \over c_i}\right) \right].\]</div>
<p><code class="docutils literal notranslate"><span class="pre">c</span></code> must be a <code class="docutils literal notranslate"><span class="pre">bigint</span></code> column of non-negative values.</p>
<p>The function ignores any <code class="docutils literal notranslate"><span class="pre">NULL</span></code> count. If the sum of non-<code class="docutils literal notranslate"><span class="pre">NULL</span></code> counts is 0,
it returns 0.</p>
</dd></dl>
<dl class="py function">
<dt id="kurtosis">
<code class="sig-name descname">kurtosis</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#kurtosis" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>Returns the excess kurtosis of all input values. Unbiased estimate using
the following expression:</p>
<div class="math notranslate nohighlight">
\[\mathrm{kurtosis}(x) = {n(n+1) \over (n-1)(n-2)(n-3)} { \sum[(x_i-\mu)^4] \over \sigma^4} -3{ (n-1)^2 \over (n-2)(n-3) },\]</div>
</div></blockquote>
<p>where <span class="math notranslate nohighlight">\(\mu\)</span> is the mean, and <span class="math notranslate nohighlight">\(\sigma\)</span> is the standard deviation.</p>
</dd></dl>
<dl class="py function">
<dt id="regr_intercept">
<code class="sig-name descname">regr_intercept</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#regr_intercept" title="Permalink to this definition">#</a></dt>
<dd><p>Returns linear regression intercept of input values. <code class="docutils literal notranslate"><span class="pre">y</span></code> is the dependent
value. <code class="docutils literal notranslate"><span class="pre">x</span></code> is the independent value.</p>
</dd></dl>
<dl class="py function">
<dt id="regr_slope">
<code class="sig-name descname">regr_slope</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#regr_slope" title="Permalink to this definition">#</a></dt>
<dd><p>Returns linear regression slope of input values. <code class="docutils literal notranslate"><span class="pre">y</span></code> is the dependent
value. <code class="docutils literal notranslate"><span class="pre">x</span></code> is the independent value.</p>
</dd></dl>
<dl class="py function">
<dt id="skewness">
<code class="sig-name descname">skewness</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#skewness" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the skewness of all input values.</p>
</dd></dl>
<dl class="py function">
<dt id="stddev">
<code class="sig-name descname">stddev</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#stddev" title="Permalink to this definition">#</a></dt>
<dd><p>This is an alias for <a class="reference internal" href="#stddev_samp" title="stddev_samp"><code class="xref py py-func docutils literal notranslate"><span class="pre">stddev_samp()</span></code></a>.</p>
</dd></dl>
<dl class="py function">
<dt id="stddev_pop">
<code class="sig-name descname">stddev_pop</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#stddev_pop" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the population standard deviation of all input values.</p>
</dd></dl>
<dl class="py function">
<dt id="stddev_samp">
<code class="sig-name descname">stddev_samp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#stddev_samp" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the sample standard deviation of all input values.</p>
</dd></dl>
<dl class="py function">
<dt id="variance">
<code class="sig-name descname">variance</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#variance" title="Permalink to this definition">#</a></dt>
<dd><p>This is an alias for <a class="reference internal" href="#var_samp" title="var_samp"><code class="xref py py-func docutils literal notranslate"><span class="pre">var_samp()</span></code></a>.</p>
</dd></dl>
<dl class="py function">
<dt id="var_pop">
<code class="sig-name descname">var_pop</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#var_pop" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the population variance of all input values.</p>
</dd></dl>
<dl class="py function">
<dt id="var_samp">
<code class="sig-name descname">var_samp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#var_samp" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the sample variance of all input values.</p>
</dd></dl>
</section>
<section id="classification-metrics-aggregate-functions">
<h2 id="classification-metrics-aggregate-functions">Classification Metrics Aggregate Functions<a class="headerlink" href="#classification-metrics-aggregate-functions" title="Permalink to this headline">#</a></h2>
<p>The following functions each measure how some metric of a binary
<a class="reference external" href="https://en.wikipedia.org/wiki/Confusion_matrix">confusion matrix</a> changes as a function of
classification thresholds. They are meant to be used in conjunction.</p>
<p>For example, to find the <a class="reference external" href="https://en.wikipedia.org/wiki/Precision_and_recall">precision-recall curve</a>, use</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WITH
    recall_precision AS (
        SELECT
            CLASSIFICATION_RECALL(10000, correct, pred) AS recalls,
            CLASSIFICATION_PRECISION(10000, correct, pred) AS precisions
        FROM
           classification_dataset
    )
SELECT
    recall,
    precision
FROM
    recall_precision
CROSS JOIN UNNEST(recalls, precisions) AS t(recall, precision)
</pre></div>
</div>
</div></blockquote>
<p>To get the corresponding thresholds for these values, use</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WITH
    recall_precision AS (
        SELECT
            CLASSIFICATION_THRESHOLDS(10000, correct, pred) AS thresholds,
            CLASSIFICATION_RECALL(10000, correct, pred) AS recalls,
            CLASSIFICATION_PRECISION(10000, correct, pred) AS precisions
        FROM
           classification_dataset
    )
SELECT
    threshold,
    recall,
    precision
FROM
    recall_precision
CROSS JOIN UNNEST(thresholds, recalls, precisions) AS t(threshold, recall, precision)
</pre></div>
</div>
</div></blockquote>
<p>To find the <a class="reference external" href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">ROC curve</a>, use</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>WITH
    fallout_recall AS (
        SELECT
            CLASSIFICATION_FALLOUT(10000, correct, pred) AS fallouts,
            CLASSIFICATION_RECALL(10000, correct, pred) AS recalls
        FROM
           classification_dataset
    )
SELECT
    fallout
    recall,
FROM
    recall_fallout
CROSS JOIN UNNEST(fallouts, recalls) AS t(fallout, recall)
</pre></div>
</div>
</div></blockquote>
<dl class="py function">
<dt id="classification_miss_rate">
<code class="sig-name descname">classification_miss_rate</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">buckets</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">weight</span></em><span class="sig-paren">)</span> → array&lt;double&gt;<a class="headerlink" href="#classification_miss_rate" title="Permalink to this definition">#</a></dt>
<dd><p>Computes the miss-rate with up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> number of buckets. Returns
an array of miss-rate values.</p>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code> should be a boolean outcome value; <code class="docutils literal notranslate"><span class="pre">x</span></code> should be predictions, each
between 0 and 1; <code class="docutils literal notranslate"><span class="pre">weight</span></code> should be non-negative values, indicating the weight of the instance.</p>
<p>The
<a class="reference external" href="https://en.wikipedia.org/wiki/Type_I_and_type_II_errors#False_positive_and_false_negative_rates">miss-rate</a>
is defined as a sequence whose <span class="math notranslate nohighlight">\(j\)</span>-th entry is</p>
<div class="math notranslate nohighlight">
\[{
    \sum_{i \;|\; x_i \leq t_j \bigwedge y_i = 1} \left[ w_i \right]
    \over
    \sum_{i \;|\; x_i \leq t_j \bigwedge y_i = 1} \left[ w_i \right]
    +
    \sum_{i \;|\; x_i &gt; t_j \bigwedge y_i = 1} \left[ w_i \right]
},\]</div>
<p>where <span class="math notranslate nohighlight">\(t_j\)</span> is the <span class="math notranslate nohighlight">\(j\)</span>-th smallest threshold,
and <span class="math notranslate nohighlight">\(y_i\)</span>, <span class="math notranslate nohighlight">\(x_i\)</span>, and <span class="math notranslate nohighlight">\(w_i\)</span> are the <span class="math notranslate nohighlight">\(i\)</span>-th
entries of <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, and <code class="docutils literal notranslate"><span class="pre">weight</span></code>, respectively.</p>
</dd></dl>
<dl class="py function">
<dt id="id16">
<code class="sig-name descname">classification_miss_rate</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">buckets</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → array&lt;double&gt;<a class="headerlink" href="#id16" title="Permalink to this definition">#</a></dt>
<dd><p>This function is equivalent to the variant of
<a class="reference internal" href="#id16" title="classification_miss_rate"><code class="xref py py-func docutils literal notranslate"><span class="pre">classification_miss_rate()</span></code></a> that takes a <code class="docutils literal notranslate"><span class="pre">weight</span></code>, with a per-item weight of <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="classification_fall_out">
<code class="sig-name descname">classification_fall_out</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">buckets</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">weight</span></em><span class="sig-paren">)</span> → array&lt;double&gt;<a class="headerlink" href="#classification_fall_out" title="Permalink to this definition">#</a></dt>
<dd><p>Computes the fall-out with up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> number of buckets. Returns
an array of fall-out values.</p>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code> should be a boolean outcome value; <code class="docutils literal notranslate"><span class="pre">x</span></code> should be predictions, each
between 0 and 1; <code class="docutils literal notranslate"><span class="pre">weight</span></code> should be non-negative values, indicating the weight of the instance.</p>
<p>The
<a class="reference external" href="https://en.wikipedia.org/wiki/Information_retrieval#Fall-out">fall-out</a>
is defined as a sequence whose <span class="math notranslate nohighlight">\(j\)</span>-th entry is</p>
<div class="math notranslate nohighlight">
\[{
    \sum_{i \;|\; x_i &gt; t_j \bigwedge y_i = 0} \left[ w_i \right]
    \over
    \sum_{i \;|\; y_i = 0} \left[ w_i \right]
},\]</div>
<p>where <span class="math notranslate nohighlight">\(t_j\)</span> is the <span class="math notranslate nohighlight">\(j\)</span>-th smallest threshold,
and <span class="math notranslate nohighlight">\(y_i\)</span>, <span class="math notranslate nohighlight">\(x_i\)</span>, and <span class="math notranslate nohighlight">\(w_i\)</span> are the <span class="math notranslate nohighlight">\(i\)</span>-th
entries of <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, and <code class="docutils literal notranslate"><span class="pre">weight</span></code>, respectively.</p>
</dd></dl>
<dl class="py function">
<dt id="id17">
<code class="sig-name descname">classification_fall_out</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">buckets</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → array&lt;double&gt;<a class="headerlink" href="#id17" title="Permalink to this definition">#</a></dt>
<dd><p>This function is equivalent to the variant of
<a class="reference internal" href="#id17" title="classification_fall_out"><code class="xref py py-func docutils literal notranslate"><span class="pre">classification_fall_out()</span></code></a> that takes a <code class="docutils literal notranslate"><span class="pre">weight</span></code>, with a per-item weight of <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="classification_precision">
<code class="sig-name descname">classification_precision</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">buckets</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">weight</span></em><span class="sig-paren">)</span> → array&lt;double&gt;<a class="headerlink" href="#classification_precision" title="Permalink to this definition">#</a></dt>
<dd><p>Computes the precision with up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> number of buckets. Returns
an array of precision values.</p>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code> should be a boolean outcome value; <code class="docutils literal notranslate"><span class="pre">x</span></code> should be predictions, each
between 0 and 1; <code class="docutils literal notranslate"><span class="pre">weight</span></code> should be non-negative values, indicating the weight of the instance.</p>
<p>The
<a class="reference external" href="https://en.wikipedia.org/wiki/Positive_and_negative_predictive_values">precision</a>
is defined as a sequence whose <span class="math notranslate nohighlight">\(j\)</span>-th entry is</p>
<div class="math notranslate nohighlight">
\[{
    \sum_{i \;|\; x_i &gt; t_j \bigwedge y_i = 1} \left[ w_i \right]
    \over
    \sum_{i \;|\; x_i &gt; t_j} \left[ w_i \right]
},\]</div>
<p>where <span class="math notranslate nohighlight">\(t_j\)</span> is the <span class="math notranslate nohighlight">\(j\)</span>-th smallest threshold,
and <span class="math notranslate nohighlight">\(y_i\)</span>, <span class="math notranslate nohighlight">\(x_i\)</span>, and <span class="math notranslate nohighlight">\(w_i\)</span> are the <span class="math notranslate nohighlight">\(i\)</span>-th
entries of <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, and <code class="docutils literal notranslate"><span class="pre">weight</span></code>, respectively.</p>
</dd></dl>
<dl class="py function">
<dt id="id18">
<code class="sig-name descname">classification_precision</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">buckets</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → array&lt;double&gt;<a class="headerlink" href="#id18" title="Permalink to this definition">#</a></dt>
<dd><p>This function is equivalent to the variant of
<a class="reference internal" href="#id18" title="classification_precision"><code class="xref py py-func docutils literal notranslate"><span class="pre">classification_precision()</span></code></a> that takes a <code class="docutils literal notranslate"><span class="pre">weight</span></code>, with a per-item weight of <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="classification_recall">
<code class="sig-name descname">classification_recall</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">buckets</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">weight</span></em><span class="sig-paren">)</span> → array&lt;double&gt;<a class="headerlink" href="#classification_recall" title="Permalink to this definition">#</a></dt>
<dd><p>Computes the recall with up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> number of buckets. Returns
an array of recall values.</p>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code> should be a boolean outcome value; <code class="docutils literal notranslate"><span class="pre">x</span></code> should be predictions, each
between 0 and 1; <code class="docutils literal notranslate"><span class="pre">weight</span></code> should be non-negative values, indicating the weight of the instance.</p>
<p>The
<a class="reference external" href="https://en.wikipedia.org/wiki/Precision_and_recall#Recall">recall</a>
is defined as a sequence whose <span class="math notranslate nohighlight">\(j\)</span>-th entry is</p>
<div class="math notranslate nohighlight">
\[{
    \sum_{i \;|\; x_i &gt; t_j \bigwedge y_i = 1} \left[ w_i \right]
    \over
    \sum_{i \;|\; y_i = 1} \left[ w_i \right]
},\]</div>
<p>where <span class="math notranslate nohighlight">\(t_j\)</span> is the <span class="math notranslate nohighlight">\(j\)</span>-th smallest threshold,
and <span class="math notranslate nohighlight">\(y_i\)</span>, <span class="math notranslate nohighlight">\(x_i\)</span>, and <span class="math notranslate nohighlight">\(w_i\)</span> are the <span class="math notranslate nohighlight">\(i\)</span>-th
entries of <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, and <code class="docutils literal notranslate"><span class="pre">weight</span></code>, respectively.</p>
</dd></dl>
<dl class="py function">
<dt id="id19">
<code class="sig-name descname">classification_recall</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">buckets</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → array&lt;double&gt;<a class="headerlink" href="#id19" title="Permalink to this definition">#</a></dt>
<dd><p>This function is equivalent to the variant of
<a class="reference internal" href="#id19" title="classification_recall"><code class="xref py py-func docutils literal notranslate"><span class="pre">classification_recall()</span></code></a> that takes a <code class="docutils literal notranslate"><span class="pre">weight</span></code>, with a per-item weight of <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd></dl>
<dl class="py function">
<dt id="classification_thresholds">
<code class="sig-name descname">classification_thresholds</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">buckets</span></em>, <em class="sig-param"><span class="n">y</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span> → array&lt;double&gt;<a class="headerlink" href="#classification_thresholds" title="Permalink to this definition">#</a></dt>
<dd><p>Computes the thresholds with up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> number of buckets. Returns
an array of threshold values.</p>
<p><code class="docutils literal notranslate"><span class="pre">y</span></code> should be a boolean outcome value; <code class="docutils literal notranslate"><span class="pre">x</span></code> should be predictions, each
between 0 and 1.</p>
<p>The thresholds are defined as a sequence whose <span class="math notranslate nohighlight">\(j\)</span>-th entry is the <span class="math notranslate nohighlight">\(j\)</span>-th smallest threshold.</p>
</dd></dl>
</section>
<section id="differential-entropy-functions">
<h2 id="differential-entropy-functions">Differential Entropy Functions<a class="headerlink" href="#differential-entropy-functions" title="Permalink to this headline">#</a></h2>
<p>The following functions approximate the binary <a class="reference external" href="https://en.wikipedia.org/wiki/Differential_entropy">differential entropy</a>.
That is, for a random variable <span class="math notranslate nohighlight">\(x\)</span>, they approximate</p>
<div class="math notranslate nohighlight">
\[h(x) = - \int x \log_2\left(f(x)\right) dx,\]</div>
<p>where <span class="math notranslate nohighlight">\(f(x)\)</span> is the partial density function of <span class="math notranslate nohighlight">\(x\)</span>.</p>
<dl class="py function">
<dt id="differential_entropy">
<code class="sig-name descname">differential_entropy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sample_size</span></em>, <em class="sig-param"><span class="n">x</span></em><span class="sig-paren">)</span><a class="headerlink" href="#differential_entropy" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the approximate log-2 differential entropy from a random variable’s sample outcomes. The function internally
creates a reservoir (see <a class="reference internal" href="#black2015" id="id20"><span>[Black2015]</span></a>), then calculates the
entropy from the sample results by approximating the derivative of the cumulative distribution
(see <a class="reference internal" href="#alizadeh2010" id="id21"><span>[Alizadeh2010]</span></a>).</p>
<p><code class="docutils literal notranslate"><span class="pre">sample_size</span></code> (<code class="docutils literal notranslate"><span class="pre">long</span></code>) is the maximal number of reservoir samples.</p>
<p><code class="docutils literal notranslate"><span class="pre">x</span></code> (<code class="docutils literal notranslate"><span class="pre">double</span></code>) is the samples.</p>
<p>For example, to find the differential entropy of <code class="docutils literal notranslate"><span class="pre">x</span></code> of <code class="docutils literal notranslate"><span class="pre">data</span></code> using 1000000 reservoir samples, use</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SELECT
    differential_entropy(1000000, x)
FROM
    data
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <span class="math notranslate nohighlight">\(x\)</span> has a known lower and upper bound,
prefer the versions taking <code class="docutils literal notranslate"><span class="pre">(bucket_count,</span> <span class="pre">x,</span> <span class="pre">1.0,</span> <span class="pre">"fixed_histogram_mle",</span> <span class="pre">min,</span> <span class="pre">max)</span></code>,
or <code class="docutils literal notranslate"><span class="pre">(bucket_count,</span> <span class="pre">x,</span> <span class="pre">1.0,</span> <span class="pre">"fixed_histogram_jacknife",</span> <span class="pre">min,</span> <span class="pre">max)</span></code>,
as they have better convergence.</p>
</div>
</dd></dl>
<dl class="py function">
<dt id="id22">
<code class="sig-name descname">differential_entropy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sample_size</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">weight</span></em><span class="sig-paren">)</span><a class="headerlink" href="#id22" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the approximate log-2 differential entropy from a random variable’s sample outcomes. The function
internally creates a weighted reservoir (see <a class="reference internal" href="#efraimidis2006" id="id23"><span>[Efraimidis2006]</span></a>), then calculates the
entropy from the sample results by approximating the derivative of the cumulative distribution
(see <a class="reference internal" href="#alizadeh2010" id="id24"><span>[Alizadeh2010]</span></a>).</p>
<p><code class="docutils literal notranslate"><span class="pre">sample_size</span></code> is the maximal number of reservoir samples.</p>
<p><code class="docutils literal notranslate"><span class="pre">x</span></code> (<code class="docutils literal notranslate"><span class="pre">double</span></code>) is the samples.</p>
<p><code class="docutils literal notranslate"><span class="pre">weight</span></code> (<code class="docutils literal notranslate"><span class="pre">double</span></code>) is a non-negative double value indicating the weight of the sample.</p>
<p>For example, to find the differential entropy of <code class="docutils literal notranslate"><span class="pre">x</span></code> with weights <code class="docutils literal notranslate"><span class="pre">weight</span></code> of <code class="docutils literal notranslate"><span class="pre">data</span></code>
using 1000000 reservoir samples, use</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SELECT
    differential_entropy(1000000, x, weight)
FROM
    data
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <span class="math notranslate nohighlight">\(x\)</span> has a known lower and upper bound,
prefer the versions taking <code class="docutils literal notranslate"><span class="pre">(bucket_count,</span> <span class="pre">x,</span> <span class="pre">weight,</span> <span class="pre">"fixed_histogram_mle",</span> <span class="pre">min,</span> <span class="pre">max)</span></code>,
or <code class="docutils literal notranslate"><span class="pre">(bucket_count,</span> <span class="pre">x,</span> <span class="pre">weight,</span> <span class="pre">"fixed_histogram_jacknife",</span> <span class="pre">min,</span> <span class="pre">max)</span></code>,
as they have better convergence.</p>
</div>
</dd></dl>
<dl class="py function">
<dt id="id25">
<code class="sig-name descname">differential_entropy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">bucket_count</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">weight</span></em>, <em class="sig-param"><span class="n">method</span></em>, <em class="sig-param"><span class="n">min</span></em>, <em class="sig-param"><span class="n">max</span></em><span class="sig-paren">)</span> → double<a class="headerlink" href="#id25" title="Permalink to this definition">#</a></dt>
<dd><p>Returns the approximate log-2 differential entropy from a random variable’s sample outcomes. The function
internally creates a conceptual histogram of the sample values, calculates the counts, and
then approximates the entropy using maximum likelihood with or without Jacknife
correction, based on the <code class="docutils literal notranslate"><span class="pre">method</span></code> parameter. If Jacknife correction (see <a class="reference internal" href="#beirlant2001" id="id26"><span>[Beirlant2001]</span></a>) is used, the
estimate is</p>
<div class="math notranslate nohighlight">
\[n H(x) - (n - 1) \sum_{i = 1}^n H\left(x_{(i)}\right)\]</div>
<p>where <span class="math notranslate nohighlight">\(n\)</span> is the length of the sequence, and <span class="math notranslate nohighlight">\(x_{(i)}\)</span> is the sequence with the <span class="math notranslate nohighlight">\(i\)</span>-th element
removed.</p>
<p><code class="docutils literal notranslate"><span class="pre">bucket_count</span></code> (<code class="docutils literal notranslate"><span class="pre">long</span></code>) determines the number of histogram buckets.</p>
<p><code class="docutils literal notranslate"><span class="pre">x</span></code> (<code class="docutils literal notranslate"><span class="pre">double</span></code>) is the samples.</p>
<p><code class="docutils literal notranslate"><span class="pre">method</span></code> (<code class="docutils literal notranslate"><span class="pre">varchar</span></code>) is either <code class="docutils literal notranslate"><span class="pre">'fixed_histogram_mle'</span></code> (for the maximum likelihood estimate)
or <code class="docutils literal notranslate"><span class="pre">'fixed_histogram_jacknife'</span></code> (for the jacknife-corrected maximum likelihood estimate).</p>
<p><code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code> (both <code class="docutils literal notranslate"><span class="pre">double</span></code>) are the minimal and maximal values, respectively;
the function will throw if there is an input outside this range.</p>
<p><code class="docutils literal notranslate"><span class="pre">weight</span></code> (<code class="docutils literal notranslate"><span class="pre">double</span></code>) is the weight of the sample, and must be non-negative.</p>
<p>For example, to find the differential entropy of <code class="docutils literal notranslate"><span class="pre">x</span></code>, each between <code class="docutils literal notranslate"><span class="pre">0.0</span></code> and <code class="docutils literal notranslate"><span class="pre">1.0</span></code>,
with weights 1.0 of <code class="docutils literal notranslate"><span class="pre">data</span></code> using 1000000 bins and jacknife estimates, use</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SELECT
    differential_entropy(1000000, x, 1.0, 'fixed_histogram_jacknife', 0.0, 1.0)
FROM
    data
</pre></div>
</div>
<p>To find the differential entropy of <code class="docutils literal notranslate"><span class="pre">x</span></code>, each between <code class="docutils literal notranslate"><span class="pre">-2.0</span></code> and <code class="docutils literal notranslate"><span class="pre">2.0</span></code>,
with weights <code class="docutils literal notranslate"><span class="pre">weight</span></code> of <code class="docutils literal notranslate"><span class="pre">data</span></code> using 1000000 buckets and maximum-likelihood estimates, use</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SELECT
    differential_entropy(1000000, x, weight, 'fixed_histogram_mle', -2.0, 2.0)
FROM
    data
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <span class="math notranslate nohighlight">\(x\)</span> doesn’t have known lower and upper bounds, prefer the versions taking <code class="docutils literal notranslate"><span class="pre">(sample_size,</span> <span class="pre">x)</span></code>
(unweighted case) or <code class="docutils literal notranslate"><span class="pre">(sample_size,</span> <span class="pre">x,</span> <span class="pre">weight)</span></code> (weighted case), as they use reservoir
sampling which doesn’t require a known range for samples.</p>
<p>Otherwise, if the number of distinct weights is low,
especially if the number of samples is low, consider using the version taking
<code class="docutils literal notranslate"><span class="pre">(bucket_count,</span> <span class="pre">x,</span> <span class="pre">weight,</span> <span class="pre">"fixed_histogram_jacknife",</span> <span class="pre">min,</span> <span class="pre">max)</span></code>, as jacknife bias correction,
is better than maximum likelihood estimation. However, if the number of distinct weights is high,
consider using the version taking <code class="docutils literal notranslate"><span class="pre">(bucket_count,</span> <span class="pre">x,</span> <span class="pre">weight,</span> <span class="pre">"fixed_histogram_mle",</span> <span class="pre">min,</span> <span class="pre">max)</span></code>,
as this will reduce memory and running time.</p>
</div>
</dd></dl>
<dl class="py function">
<dt id="approx_most_frequent">
<code class="sig-name descname">approx_most_frequent</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">buckets</span></em>, <em class="sig-param"><span class="n">value</span></em>, <em class="sig-param"><span class="n">capacity</span></em><span class="sig-paren">)</span> → map&lt;[same as value], bigint&gt;<a class="headerlink" href="#approx_most_frequent" title="Permalink to this definition">#</a></dt>
<dd><p>Computes the top frequent values up to <code class="docutils literal notranslate"><span class="pre">buckets</span></code> elements approximately.
Approximate estimation of the function enables us to pick up the frequent
values with less memory. Larger <code class="docutils literal notranslate"><span class="pre">capacity</span></code> improves the accuracy of
underlying algorithm with sacrificing the memory capacity. The returned
value is a map containing the top elements with corresponding estimated
frequency.</p>
<p>The error of the function depends on the permutation of the values and its
cardinality. We can set the capacity same as the cardinality of the
underlying data to achieve the least error.</p>
<p><code class="docutils literal notranslate"><span class="pre">buckets</span></code> and <code class="docutils literal notranslate"><span class="pre">capacity</span></code> must be <code class="docutils literal notranslate"><span class="pre">bigint</span></code>. <code class="docutils literal notranslate"><span class="pre">value</span></code> can be numeric
or string type.</p>
<p>The function uses the stream summary data structure proposed in the paper
<a class="reference external" href="https://www.cse.ust.hk/~raywong/comp5331/References/EfficientComputationOfFrequentAndTop-kElementsInDataStreams.pdf">Efficient computation of frequent and top-k elements in data streams</a> by A.Metwalley, D.Agrawl and A.Abbadi.</p>
</dd></dl>
<hr class="docutils"/>
<dl class="citation">
<dt class="label" id="alizadeh2010"><span class="brackets">Alizadeh2010</span><span class="fn-backref">(<a href="#id21">1</a>,<a href="#id24">2</a>)</span></dt>
<dd><p>Alizadeh Noughabi, Hadi &amp; Arghami, N. (2010). “A New Estimator of Entropy”.</p>
</dd>
<dt class="label" id="beirlant2001"><span class="brackets"><a class="fn-backref" href="#id26">Beirlant2001</a></span></dt>
<dd><p>Beirlant, Dudewicz, Gyorfi, and van der Meulen,
“Nonparametric entropy estimation: an overview”, (2001)</p>
</dd>
<dt class="label" id="benhaimtomtov2010"><span class="brackets"><a class="fn-backref" href="#id14">BenHaimTomTov2010</a></span></dt>
<dd><p>Yael Ben-Haim and Elad Tom-Tov, “A streaming parallel decision tree algorithm”,
J. Machine Learning Research 11 (2010), pp. 849–872.</p>
</dd>
<dt class="label" id="black2015"><span class="brackets"><a class="fn-backref" href="#id20">Black2015</a></span></dt>
<dd><p>Black, Paul E. (26 January 2015). “Reservoir sampling”. Dictionary of Algorithms and Data Structures.</p>
</dd>
<dt class="label" id="efraimidis2006"><span class="brackets"><a class="fn-backref" href="#id23">Efraimidis2006</a></span></dt>
<dd><p>Efraimidis, Pavlos S.; Spirakis, Paul G. (2006-03-16). “Weighted random sampling with a reservoir”.
Information Processing Letters. 97 (5): 181–185.</p>
</dd>
</dl>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="datetime.html" title="Date and Time Functions and Operators"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Date and Time Functions and Operators </span>
              </div>
            </a>
          
          
            <a href="window.html" title="Window Functions"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Window Functions </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright The Presto Foundation. All rights reserved. Presto is a registered trademark of LF Projects, LLC.
              
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>