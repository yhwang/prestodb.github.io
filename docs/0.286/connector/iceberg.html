

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  
  <link rel="stylesheet" href="../_static/fonts/font-awesome.css"/>

  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="374665">
  <script src="../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K7GB6F0LBZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'G-K7GB6F0LBZ');
</script>
  
  
    <title>Iceberg Connector &#8212; Presto 0.286 Documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/presto.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="JMX Connector" href="jmx.html" />
    <link rel="prev" title="Hudi connector" href="hudi.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=grey data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#connector/iceberg" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Presto 0.286 Documentation"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/logo.png" height="26"
                   alt="Presto 0.286 Documentation logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Presto 0.286 Documentation</span>
          <span class="md-header-nav__topic"> Iceberg Connector </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    <!-- empty -->
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Presto 0.286 Documentation" class="md-nav__button md-logo">
      
        <img src="../_static/logo.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Presto 0.286 Documentation">Presto 0.286 Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../cache.html" class="md-nav__link">Cache</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query Optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="accumulo.html" class="md-nav__link">Accumulo Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="bigquery.html" class="md-nav__link">BigQuery Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="blackhole.html" class="md-nav__link">Black Hole Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cassandra.html" class="md-nav__link">Cassandra Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="clickhouse.html" class="md-nav__link">ClickHouse connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="deltalake.html" class="md-nav__link">Delta Lake Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="druid.html" class="md-nav__link">Druid Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="elasticsearch.html" class="md-nav__link">Elasticsearch Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="googlesheets.html" class="md-nav__link">Google Sheets connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hana.html" class="md-nav__link">HANA Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive.html" class="md-nav__link">Hive Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hive-security.html" class="md-nav__link">Hive Security Configuration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hudi.html" class="md-nav__link">Hudi connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Iceberg Connector </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Iceberg Connector</a>
      
        

<nav class="md-nav md-nav--secondary">
  
  <ul class="md-nav__list" data-md-scrollfix="">
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/tree/master/presto-docs/src/main/sphinx/connector/iceberg.rst">
        <i class="fa fa-file-text" aria-hidden="true"></i>
        View page source
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/edit/master/presto-docs/src/main/sphinx/connector/iceberg.rst">
        <i class="fa fa-pencil-square" aria-hidden="true"></i>
        Edit this page
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new?title=Documentation&amp;labels=docs">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create docs issue
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create project issue
      </a>
    </li>
  </ul>
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#connector-iceberg--page-root" class="md-nav__link" data-md-state="blur">Iceberg Connector</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#overview" class="md-nav__link" data-md-state="blur">Overview</a>
        </li>
        <li class="md-nav__item"><a href="#metastores" class="md-nav__link" data-md-state="blur">Metastores</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#hive-metastore-catalog" class="md-nav__link" data-md-state="blur">Hive Metastore catalog</a>
        </li>
        <li class="md-nav__item"><a href="#glue-catalog" class="md-nav__link" data-md-state="blur">Glue catalog</a>
        </li>
        <li class="md-nav__item"><a href="#nessie-catalog" class="md-nav__link" data-md-state="blur">Nessie catalog</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#setting-up-nessie-with-docker" class="md-nav__link" data-md-state="blur">Setting Up Nessie With Docker</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#hadoop-catalog" class="md-nav__link" data-md-state="blur">Hadoop catalog</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#configuration-properties" class="md-nav__link" data-md-state="blur">Configuration Properties</a>
        </li>
        <li class="md-nav__item"><a href="#table-properties" class="md-nav__link" data-md-state="blur">Table Properties</a>
        </li>
        <li class="md-nav__item"><a href="#session-properties" class="md-nav__link" data-md-state="blur">Session Properties</a>
        </li>
        <li class="md-nav__item"><a href="#caching-support" class="md-nav__link" data-md-state="blur">Caching Support</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#manifest-file-caching" class="md-nav__link" data-md-state="blur">Manifest File Caching</a>
        </li>
        <li class="md-nav__item"><a href="#alluxio-data-cache" class="md-nav__link" data-md-state="blur">Alluxio Data Cache</a>
        </li>
        <li class="md-nav__item"><a href="#file-and-stripe-footer-cache" class="md-nav__link" data-md-state="blur">File And Stripe Footer Cache</a>
        </li>
        <li class="md-nav__item"><a href="#metastore-versioned-cache" class="md-nav__link" data-md-state="blur">Metastore Versioned Cache</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#extra-hidden-metadata-columns" class="md-nav__link" data-md-state="blur">Extra Hidden Metadata Columns</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#path-column" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$path</span></code> column</a>
        </li>
        <li class="md-nav__item"><a href="#data-sequence-number-column" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$data_sequence_number</span></code> column</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#extra-hidden-metadata-tables" class="md-nav__link" data-md-state="blur">Extra Hidden Metadata Tables</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#properties-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$properties</span></code> Table</a>
        </li>
        <li class="md-nav__item"><a href="#history-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$history</span></code> Table</a>
        </li>
        <li class="md-nav__item"><a href="#snapshots-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$snapshots</span></code> Table</a>
        </li>
        <li class="md-nav__item"><a href="#manifests-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$manifests</span></code> Table</a>
        </li>
        <li class="md-nav__item"><a href="#partitions-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$partitions</span></code> Table</a>
        </li>
        <li class="md-nav__item"><a href="#files-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$files</span></code> Table</a>
        </li>
        <li class="md-nav__item"><a href="#changelog-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$changelog</span></code> Table</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#sql-support" class="md-nav__link" data-md-state="blur">SQL Support</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#create-schema" class="md-nav__link" data-md-state="blur">CREATE SCHEMA</a>
        </li>
        <li class="md-nav__item"><a href="#create-table" class="md-nav__link" data-md-state="blur">CREATE TABLE</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#partition-column-transform" class="md-nav__link" data-md-state="blur">Partition Column Transform</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#create-view" class="md-nav__link" data-md-state="blur">CREATE VIEW</a>
        </li>
        <li class="md-nav__item"><a href="#insert-into" class="md-nav__link" data-md-state="blur">INSERT INTO</a>
        </li>
        <li class="md-nav__item"><a href="#create-table-as-select" class="md-nav__link" data-md-state="blur">CREATE TABLE AS SELECT</a>
        </li>
        <li class="md-nav__item"><a href="#select" class="md-nav__link" data-md-state="blur">SELECT</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#table-with-delete-files" class="md-nav__link" data-md-state="blur">Table with delete files</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#alter-table" class="md-nav__link" data-md-state="blur">ALTER TABLE</a>
        </li>
        <li class="md-nav__item"><a href="#truncate" class="md-nav__link" data-md-state="blur">TRUNCATE</a>
        </li>
        <li class="md-nav__item"><a href="#delete" class="md-nav__link" data-md-state="blur">DELETE</a>
        </li>
        <li class="md-nav__item"><a href="#drop-table" class="md-nav__link" data-md-state="blur">DROP TABLE</a>
        </li>
        <li class="md-nav__item"><a href="#drop-view" class="md-nav__link" data-md-state="blur">DROP VIEW</a>
        </li>
        <li class="md-nav__item"><a href="#drop-schema" class="md-nav__link" data-md-state="blur">DROP SCHEMA</a>
        </li>
        <li class="md-nav__item"><a href="#register-table" class="md-nav__link" data-md-state="blur">Register table</a>
        </li>
        <li class="md-nav__item"><a href="#unregister-table" class="md-nav__link" data-md-state="blur">Unregister table</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#schema-evolution" class="md-nav__link" data-md-state="blur">Schema Evolution</a>
        </li>
        <li class="md-nav__item"><a href="#parquet-writer-version" class="md-nav__link" data-md-state="blur">Parquet Writer Version</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#example-queries" class="md-nav__link" data-md-state="blur">Example Queries</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#time-travel" class="md-nav__link" data-md-state="blur">Time Travel</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#id1" class="md-nav__link" data-md-state="blur">Example Queries</a>
        </li>
        <li class="md-nav__item"><a href="#time-travel-using-version-system-version-and-timestamp-system-time" class="md-nav__link" data-md-state="blur">Time Travel using VERSION (SYSTEM_VERSION) and TIMESTAMP (SYSTEM_TIME)</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="jmx.html" class="md-nav__link">JMX Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="kafka.html" class="md-nav__link">Kafka Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="kafka-tutorial.html" class="md-nav__link">Kafka Connector Tutorial</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="kudu.html" class="md-nav__link">Kudu Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="larksheets.html" class="md-nav__link">Lark Sheets connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="localfile.html" class="md-nav__link">Local File Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="memory.html" class="md-nav__link">Memory Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mongodb.html" class="md-nav__link">MongoDB Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="mysql.html" class="md-nav__link">MySQL Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="oracle.html" class="md-nav__link">Oracle Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="pinot.html" class="md-nav__link">Apache Pinot Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="postgresql.html" class="md-nav__link">PostgreSQL Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="prometheus.html" class="md-nav__link">Prometheus Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="redis.html" class="md-nav__link">Redis Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="redshift.html" class="md-nav__link">Redshift Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="scylladb.html" class="md-nav__link">ScyllaDB Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="singlestore.html" class="md-nav__link">SingleStore Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="sqlserver.html" class="md-nav__link">SQL Server Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="system.html" class="md-nav__link">System Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="thrift.html" class="md-nav__link">Thrift Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tpcds.html" class="md-nav__link">TPCDS Connector</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tpch.html" class="md-nav__link">TPCH Connector</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../plugin.html" class="md-nav__link">Plugins</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL Language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL Statement Syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../migration.html" class="md-nav__link">Migration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../rest.html" class="md-nav__link">REST API</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../ecosystem.html" class="md-nav__link">Ecosystem</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../router.html" class="md-nav__link">Router</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release Notes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                

<nav class="md-nav md-nav--secondary">
  
  <ul class="md-nav__list" data-md-scrollfix="">
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/tree/master/presto-docs/src/main/sphinx/connector/iceberg.rst">
        <i class="fa fa-file-text" aria-hidden="true"></i>
        View page source
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/edit/master/presto-docs/src/main/sphinx/connector/iceberg.rst">
        <i class="fa fa-pencil-square" aria-hidden="true"></i>
        Edit this page
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new?title=Documentation&amp;labels=docs">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create docs issue
      </a>
    </li>
    <li class="md-nav__item">
      <a class="md-nav__link" target="_blank" href="https://github.com/prestodb/presto/issues/new">
        <i class="fa fa-list" aria-hidden="true"></i>
        Create project issue
      </a>
    </li>
  </ul>
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#connector-iceberg--page-root" class="md-nav__link" data-md-state="blur">Iceberg Connector</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#overview" class="md-nav__link" data-md-state="blur">Overview</a>
        </li>
        <li class="md-nav__item"><a href="#metastores" class="md-nav__link" data-md-state="blur">Metastores</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#hive-metastore-catalog" class="md-nav__link" data-md-state="blur">Hive Metastore catalog</a>
        </li>
        <li class="md-nav__item"><a href="#glue-catalog" class="md-nav__link" data-md-state="blur">Glue catalog</a>
        </li>
        <li class="md-nav__item"><a href="#nessie-catalog" class="md-nav__link" data-md-state="blur">Nessie catalog</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#setting-up-nessie-with-docker" class="md-nav__link" data-md-state="blur">Setting Up Nessie With Docker</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#hadoop-catalog" class="md-nav__link" data-md-state="blur">Hadoop catalog</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#configuration-properties" class="md-nav__link" data-md-state="blur">Configuration Properties</a>
        </li>
        <li class="md-nav__item"><a href="#table-properties" class="md-nav__link" data-md-state="blur">Table Properties</a>
        </li>
        <li class="md-nav__item"><a href="#session-properties" class="md-nav__link" data-md-state="blur">Session Properties</a>
        </li>
        <li class="md-nav__item"><a href="#caching-support" class="md-nav__link" data-md-state="blur">Caching Support</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#manifest-file-caching" class="md-nav__link" data-md-state="blur">Manifest File Caching</a>
        </li>
        <li class="md-nav__item"><a href="#alluxio-data-cache" class="md-nav__link" data-md-state="blur">Alluxio Data Cache</a>
        </li>
        <li class="md-nav__item"><a href="#file-and-stripe-footer-cache" class="md-nav__link" data-md-state="blur">File And Stripe Footer Cache</a>
        </li>
        <li class="md-nav__item"><a href="#metastore-versioned-cache" class="md-nav__link" data-md-state="blur">Metastore Versioned Cache</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#extra-hidden-metadata-columns" class="md-nav__link" data-md-state="blur">Extra Hidden Metadata Columns</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#path-column" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$path</span></code> column</a>
        </li>
        <li class="md-nav__item"><a href="#data-sequence-number-column" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$data_sequence_number</span></code> column</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#extra-hidden-metadata-tables" class="md-nav__link" data-md-state="blur">Extra Hidden Metadata Tables</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#properties-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$properties</span></code> Table</a>
        </li>
        <li class="md-nav__item"><a href="#history-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$history</span></code> Table</a>
        </li>
        <li class="md-nav__item"><a href="#snapshots-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$snapshots</span></code> Table</a>
        </li>
        <li class="md-nav__item"><a href="#manifests-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$manifests</span></code> Table</a>
        </li>
        <li class="md-nav__item"><a href="#partitions-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$partitions</span></code> Table</a>
        </li>
        <li class="md-nav__item"><a href="#files-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$files</span></code> Table</a>
        </li>
        <li class="md-nav__item"><a href="#changelog-table" class="md-nav__link" data-md-state="blur"><code class="docutils literal notranslate"><span class="pre">$changelog</span></code> Table</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#sql-support" class="md-nav__link" data-md-state="blur">SQL Support</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#create-schema" class="md-nav__link" data-md-state="blur">CREATE SCHEMA</a>
        </li>
        <li class="md-nav__item"><a href="#create-table" class="md-nav__link" data-md-state="blur">CREATE TABLE</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#partition-column-transform" class="md-nav__link" data-md-state="blur">Partition Column Transform</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#create-view" class="md-nav__link" data-md-state="blur">CREATE VIEW</a>
        </li>
        <li class="md-nav__item"><a href="#insert-into" class="md-nav__link" data-md-state="blur">INSERT INTO</a>
        </li>
        <li class="md-nav__item"><a href="#create-table-as-select" class="md-nav__link" data-md-state="blur">CREATE TABLE AS SELECT</a>
        </li>
        <li class="md-nav__item"><a href="#select" class="md-nav__link" data-md-state="blur">SELECT</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#table-with-delete-files" class="md-nav__link" data-md-state="blur">Table with delete files</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#alter-table" class="md-nav__link" data-md-state="blur">ALTER TABLE</a>
        </li>
        <li class="md-nav__item"><a href="#truncate" class="md-nav__link" data-md-state="blur">TRUNCATE</a>
        </li>
        <li class="md-nav__item"><a href="#delete" class="md-nav__link" data-md-state="blur">DELETE</a>
        </li>
        <li class="md-nav__item"><a href="#drop-table" class="md-nav__link" data-md-state="blur">DROP TABLE</a>
        </li>
        <li class="md-nav__item"><a href="#drop-view" class="md-nav__link" data-md-state="blur">DROP VIEW</a>
        </li>
        <li class="md-nav__item"><a href="#drop-schema" class="md-nav__link" data-md-state="blur">DROP SCHEMA</a>
        </li>
        <li class="md-nav__item"><a href="#register-table" class="md-nav__link" data-md-state="blur">Register table</a>
        </li>
        <li class="md-nav__item"><a href="#unregister-table" class="md-nav__link" data-md-state="blur">Unregister table</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#schema-evolution" class="md-nav__link" data-md-state="blur">Schema Evolution</a>
        </li>
        <li class="md-nav__item"><a href="#parquet-writer-version" class="md-nav__link" data-md-state="blur">Parquet Writer Version</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#example-queries" class="md-nav__link" data-md-state="blur">Example Queries</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#time-travel" class="md-nav__link" data-md-state="blur">Time Travel</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#id1" class="md-nav__link" data-md-state="blur">Example Queries</a>
        </li>
        <li class="md-nav__item"><a href="#time-travel-using-version-system-version-and-timestamp-system-time" class="md-nav__link" data-md-state="blur">Time Travel using VERSION (SYSTEM_VERSION) and TIMESTAMP (SYSTEM_TIME)</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="iceberg-connector">
<h1 id="connector-iceberg--page-root">Iceberg Connector<a class="headerlink" href="#connector-iceberg--page-root" title="Permalink to this heading">#</a></h1>
<section id="overview">
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>The Iceberg connector allows querying data stored in Iceberg tables.</p>
</section>
<section id="metastores">
<h2 id="metastores">Metastores<a class="headerlink" href="#metastores" title="Permalink to this heading">#</a></h2>
<p>Iceberg tables store most of the metadata in the metadata files, along with the data on the
filesystem, but it still requires a central place to find the current location of the
current metadata pointer for a table. This central place is called the <code class="docutils literal notranslate"><span class="pre">Iceberg</span> <span class="pre">Catalog</span></code>.
The Presto Iceberg connector supports different types of Iceberg Catalogs : <code class="docutils literal notranslate"><span class="pre">Hive</span> <span class="pre">Metastore</span></code>,
<code class="docutils literal notranslate"><span class="pre">GLUE</span></code>, <code class="docutils literal notranslate"><span class="pre">NESSIE</span></code>, and <code class="docutils literal notranslate"><span class="pre">HADOOP</span></code>.</p>
<p>To configure the Iceberg connector, create a catalog properties file
<code class="docutils literal notranslate"><span class="pre">etc/catalog/iceberg.properties</span></code>. To define the catalog type, <code class="docutils literal notranslate"><span class="pre">iceberg.catalog.type</span></code> property
is required along with the following contents, with the property values replaced as follows:</p>
<section id="hive-metastore-catalog">
<h3 id="hive-metastore-catalog">Hive Metastore catalog<a class="headerlink" href="#hive-metastore-catalog" title="Permalink to this heading">#</a></h3>
<p>The Iceberg connector supports the same configuration for
<a class="reference external" href="https://prestodb.io/docs/current/connector/hive.html#metastore-configuration-properties">HMS</a>
as a Hive connector.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>connector.name=iceberg
hive.metastore.uri=hostname:port
iceberg.catalog.type=hive
</pre></div>
</div>
</section>
<section id="glue-catalog">
<h3 id="glue-catalog">Glue catalog<a class="headerlink" href="#glue-catalog" title="Permalink to this heading">#</a></h3>
<p>The Iceberg connector supports the same configuration for
<a class="reference external" href="https://prestodb.io/docs/current/connector/hive.html#aws-glue-catalog-configuration-properties">Glue</a>
as a Hive connector.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>connector.name=iceberg
hive.metastore=glue
iceberg.catalog.type=hive
</pre></div>
</div>
</section>
<section id="nessie-catalog">
<h3 id="nessie-catalog">Nessie catalog<a class="headerlink" href="#nessie-catalog" title="Permalink to this heading">#</a></h3>
<p>To use a Nessie catalog, configure the catalog type as
<code class="docutils literal notranslate"><span class="pre">iceberg.catalog.type=nessie</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>connector.name=iceberg
iceberg.catalog.type=nessie
iceberg.catalog.warehouse=/tmp
iceberg.nessie.uri=https://localhost:19120/api/v1
</pre></div>
</div>
<p>Additional supported properties for the Nessie catalog:</p>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>Property Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.nessie.ref</span></code></p></td>
<td><p>The branch/tag to use for Nessie, defaults to <code class="docutils literal notranslate"><span class="pre">main</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.nessie.uri</span></code></p></td>
<td><p>Nessie API endpoint URI (required).
Example: <code class="docutils literal notranslate"><span class="pre">https://localhost:19120/api/v1</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.nessie.auth.type</span></code></p></td>
<td><p>The authentication type to use.
Available values are <code class="docutils literal notranslate"><span class="pre">BASIC</span></code> or <code class="docutils literal notranslate"><span class="pre">BEARER</span></code>.
Example: <code class="docutils literal notranslate"><span class="pre">BEARER</span></code></p>
<p><strong>Note:</strong> Nessie BASIC authentication type is deprecated,
this will be removed in upcoming release</p>
</td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.nessie.auth.basic.username</span></code></p></td>
<td><p>The username to use with <code class="docutils literal notranslate"><span class="pre">BASIC</span></code> authentication.
Example: <code class="docutils literal notranslate"><span class="pre">test_user</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.nessie.auth.basic.password</span></code></p></td>
<td><p>The password to use with <code class="docutils literal notranslate"><span class="pre">BASIC</span></code> authentication.
Example: <code class="docutils literal notranslate"><span class="pre">my$ecretPass</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.nessie.auth.bearer.token</span></code></p></td>
<td><p>The token to use with <code class="docutils literal notranslate"><span class="pre">BEARER</span></code> authentication.
Example: <code class="docutils literal notranslate"><span class="pre">SXVLUXUhIExFQ0tFUiEK</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.nessie.read-timeout-ms</span></code></p></td>
<td><p>The read timeout in milliseconds for requests
to the Nessie server.
Example: <code class="docutils literal notranslate"><span class="pre">5000</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.nessie.connect-timeout-ms</span></code></p></td>
<td><p>The connection timeout in milliseconds for the connection
requests to the Nessie server.
Example: <code class="docutils literal notranslate"><span class="pre">10000</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.nessie.compression-enabled</span></code></p></td>
<td><p>Configuration of whether compression should be enabled or
not for requests to the Nessie server, defaults to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.nessie.client-builder-impl</span></code></p></td>
<td><p>Configuration of the custom ClientBuilder implementation
class to be used.</p></td>
</tr>
</tbody>
</table>
<section id="setting-up-nessie-with-docker">
<h4 id="setting-up-nessie-with-docker">Setting Up Nessie With Docker<a class="headerlink" href="#setting-up-nessie-with-docker" title="Permalink to this heading">#</a></h4>
<p>To set up a Nessie instance locally using the Docker image, see <a class="reference external" href="https://projectnessie.org/try/docker/">Setting up Nessie</a>. Once the Docker instance is up and running, you should see logs similar to the following example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2023-09-05 13:11:37,905 INFO  [io.quarkus] (main) nessie-quarkus 0.69.0 on JVM (powered by Quarkus 3.2.4.Final) started in 1.921s. Listening on: http://0.0.0.0:19120
2023-09-05 13:11:37,906 INFO  [io.quarkus] (main) Profile prod activated.
2023-09-05 13:11:37,906 INFO  [io.quarkus] (main) Installed features: [agroal, amazon-dynamodb, cassandra-client, cdi, google-cloud-bigtable, hibernate-validator, jdbc-postgresql, logging-sentry, micrometer, mongodb-client, narayana-jta, oidc, opentelemetry, reactive-routes, resteasy, resteasy-jackson, security, security-properties-file, smallrye-context-propagation, smallrye-health, smallrye-openapi, swagger-ui, vertx]
</pre></div>
</div>
<p>If log messages related to Nessieâ€™s OpenTelemetry collector appear similar to the following example, you can disable OpenTelemetry using the configuration option <code class="docutils literal notranslate"><span class="pre">quarkus.otel.sdk.disabled=true</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2023-08-27 11:10:02,492 INFO  [io.qua.htt.access-log] (executor-thread-1) 172.17.0.1 - - [27/Aug/2023:11:10:02 +0000] "GET /api/v1/config HTTP/1.1" 200 62
2023-08-27 11:10:05,007 SEVERE [io.ope.exp.int.grp.OkHttpGrpcExporter] (OkHttp http://localhost:4317/...) Failed to export spans. The request could not be executed. Full error message: Failed to connect to localhost/127.0.0.1:4317
</pre></div>
</div>
<p>For example, start the Docker image using the following command:
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-p</span> <span class="pre">19120:19120</span> <span class="pre">-e</span> <span class="pre">QUARKUS_OTEL_SDK_DISABLED=true</span> <span class="pre">ghcr.io/projectnessie/nessie</span></code></p>
<p>For more information about this configuration option and other related options, see the <a class="reference external" href="https://quarkus.io/guides/opentelemetry#quarkus-opentelemetry_quarkus.otel.sdk.disabled">OpenTelemetry Configuration Reference</a>.</p>
<p>For more information about troubleshooting OpenTelemetry traces, see <a class="reference external" href="https://projectnessie.org/try/configuration/#troubleshooting-traces">Troubleshooting traces</a>.</p>
<p>If an error similar to the following example is displayed, this is probably because you are interacting with an http server, and not an https server. You need to set <code class="docutils literal notranslate"><span class="pre">iceberg.nessie.uri</span></code> to <code class="docutils literal notranslate"><span class="pre">http://localhost:19120/api/v1</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Caused by: javax.net.ssl.SSLException: Unsupported or unrecognized SSL message
    at sun.security.ssl.SSLSocketInputRecord.handleUnknownRecord(SSLSocketInputRecord.java:448)
    at sun.security.ssl.SSLSocketInputRecord.decode(SSLSocketInputRecord.java:174)
    at sun.security.ssl.SSLTransport.decode(SSLTransport.java:111)
    at sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1320)
    at sun.security.ssl.SSLSocketImpl.readHandshakeRecord(SSLSocketImpl.java:1233)
    at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:417)
    at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:389)
    at sun.net.www.protocol.https.HttpsClient.afterConnect(HttpsClient.java:558)
    at sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.java:201)
    at sun.net.www.protocol.https.HttpsURLConnectionImpl.connect(HttpsURLConnectionImpl.java:167)
    at org.projectnessie.client.http.impl.jdk8.UrlConnectionRequest.executeRequest(UrlConnectionRequest.java:71)
    ... 42 more
</pre></div>
</div>
</section>
</section>
<section id="hadoop-catalog">
<h3 id="hadoop-catalog">Hadoop catalog<a class="headerlink" href="#hadoop-catalog" title="Permalink to this heading">#</a></h3>
<p>To use a Hadoop catalog, configure the catalog type as
<code class="docutils literal notranslate"><span class="pre">iceberg.catalog.type=hadoop</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>connector.name=iceberg
iceberg.catalog.type=hadoop
iceberg.catalog.warehouse=hdfs://hostname:port
</pre></div>
</div>
</section>
</section>
<section id="configuration-properties">
<h2 id="configuration-properties">Configuration Properties<a class="headerlink" href="#configuration-properties" title="Permalink to this heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Iceberg connector supports configuration options for
<a class="reference external" href="https://prestodb.io/docs/current/connector/hive.html##amazon-s3-configuration">Amazon S3</a>
as a Hive connector.</p>
</div>
<p>The following configuration properties are available:</p>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>Property Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hive.metastore.uri</span></code></p></td>
<td><p>The URI(s) of the Hive metastore to connect to using the
Thrift protocol. If multiple URIs are provided, the first
URI is used by default, and the rest of the URIs are
fallback metastores.
Example: <code class="docutils literal notranslate"><span class="pre">thrift://192.0.2.3:9083</span></code> or
<code class="docutils literal notranslate"><span class="pre">thrift://192.0.2.3:9083,thrift://192.0.2.4:9083</span></code>
This property is required if the
<code class="docutils literal notranslate"><span class="pre">iceberg.catalog.type</span></code> is <code class="docutils literal notranslate"><span class="pre">hive</span></code>. Otherwise, it will
be ignored.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.file-format</span></code></p></td>
<td><p>The storage file format for Iceberg tables. The available
values are <code class="docutils literal notranslate"><span class="pre">PARQUET</span></code> and <code class="docutils literal notranslate"><span class="pre">ORC</span></code>.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ORC</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.compression-codec</span></code></p></td>
<td><p>The compression codec to use when writing files. The
available values are <code class="docutils literal notranslate"><span class="pre">NONE</span></code>, <code class="docutils literal notranslate"><span class="pre">SNAPPY</span></code>, <code class="docutils literal notranslate"><span class="pre">GZIP</span></code>,
<code class="docutils literal notranslate"><span class="pre">LZ4</span></code>, and <code class="docutils literal notranslate"><span class="pre">ZSTD</span></code>.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GZIP</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.catalog.type</span></code></p></td>
<td><p>The catalog type for Iceberg tables. The available values
are <code class="docutils literal notranslate"><span class="pre">hive</span></code>, <code class="docutils literal notranslate"><span class="pre">hadoop</span></code>, and <code class="docutils literal notranslate"><span class="pre">nessie</span></code> corresponding to
the catalogs in Iceberg.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">hive</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.catalog.warehouse</span></code></p></td>
<td><p>The catalog warehouse root path for Iceberg tables.
<code class="docutils literal notranslate"><span class="pre">Example:</span> <span class="pre">hdfs://nn:8020/warehouse/path</span></code>
This property is required if the <code class="docutils literal notranslate"><span class="pre">iceberg.catalog.type</span></code> is
<code class="docutils literal notranslate"><span class="pre">hadoop</span></code>. Otherwise, it will be ignored.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.catalog.cached-catalog-num</span></code></p></td>
<td><p>The number of Iceberg catalogs to cache. This property is
required if the <code class="docutils literal notranslate"><span class="pre">iceberg.catalog.type</span></code> is <code class="docutils literal notranslate"><span class="pre">hadoop</span></code>.
Otherwise, it will be ignored.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">10</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.hadoop.config.resources</span></code></p></td>
<td><p>The path(s) for Hadoop configuration resources.
<code class="docutils literal notranslate"><span class="pre">Example:</span> <span class="pre">/etc/hadoop/conf/core-site.xml.</span></code> This property
is required if the iceberg.catalog.type is hadoop. Otherwise,
it will be ignored.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.max-partitions-per-writer</span></code></p></td>
<td><p>The Maximum number of partitions handled per writer.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">100</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.minimum-assigned-split-weight</span></code></p></td>
<td><p>A decimal value in the range (0, 1] is used as a minimum
for weights assigned to each split. A low value may improve
performance on tables with small files. A higher value may
improve performance for queries with highly skewed
aggregations or joins.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0.05</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.enable-merge-on-read-mode</span></code></p></td>
<td><p>Enable reading base tables that use merge-on-read for
updates.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.delete-as-join-rewrite-enabled</span></code></p></td>
<td><p>When enabled, equality delete row filtering is applied
as a join with the data of the equality delete files.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">true</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="table-properties">
<h2 id="table-properties">Table Properties<a class="headerlink" href="#table-properties" title="Permalink to this heading">#</a></h2>
<p>Table properties set metadata for the underlying tables. This is key for
CREATE TABLE/CREATE TABLE AS statements. Table properties are passed to the
connector using a WITH clause:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">tablename</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">property_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property_value</span><span class="p">,</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The following table properties are available, which are specific to the Presto Iceberg connector:</p>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>Property Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">format</span></code></p></td>
<td><p>Optionally specifies the format of table data files,
either <code class="docutils literal notranslate"><span class="pre">PARQUET</span></code> or <code class="docutils literal notranslate"><span class="pre">ORC</span></code>. Defaults to <code class="docutils literal notranslate"><span class="pre">PARQUET</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">partitioning</span></code></p></td>
<td><p>Optionally specifies table partitioning. If a table
is partitioned by columns <code class="docutils literal notranslate"><span class="pre">c1</span></code> and <code class="docutils literal notranslate"><span class="pre">c2</span></code>, the partitioning
property is <code class="docutils literal notranslate"><span class="pre">partitioning</span> <span class="pre">=</span> <span class="pre">ARRAY['c1',</span> <span class="pre">'c2']</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">location</span></code></p></td>
<td><p>Optionally specifies the file system location URI for
the table.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">format_version</span></code></p></td>
<td><p>Optionally specifies the format version of the Iceberg
specification to use for new tables, either <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">2</span></code>.
Defaults to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></td>
</tr>
</tbody>
</table>
<p>The table definition below specifies format <code class="docutils literal notranslate"><span class="pre">ORC</span></code>, partitioning by columns <code class="docutils literal notranslate"><span class="pre">c1</span></code> and <code class="docutils literal notranslate"><span class="pre">c2</span></code>,
and a file system location of <code class="docutils literal notranslate"><span class="pre">s3://test_bucket/test_schema/test_table</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test_table</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">c1</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span>
<span class="w">    </span><span class="n">c2</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">    </span><span class="n">c3</span><span class="w"> </span><span class="n">double</span>
<span class="p">)</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ORC'</span><span class="p">,</span>
<span class="w">    </span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'c1'</span><span class="p">,</span><span class="w"> </span><span class="s1">'c2'</span><span class="p">],</span>
<span class="w">    </span><span class="k">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'s3://test_bucket/test_schema/test_table'</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="session-properties">
<h2 id="session-properties">Session Properties<a class="headerlink" href="#session-properties" title="Permalink to this heading">#</a></h2>
<p>Session properties set behavior changes for queries executed within the given session.</p>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>Property Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.delete_as_join_rewrite_enabled</span></code></p></td>
<td><p>Overrides the behavior of the connector property
<code class="docutils literal notranslate"><span class="pre">iceberg.delete-as-join-rewrite-enabled</span></code> in the current session.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="caching-support">
<h2 id="caching-support">Caching Support<a class="headerlink" href="#caching-support" title="Permalink to this heading">#</a></h2>
<section id="manifest-file-caching">
<h3 id="manifest-file-caching">Manifest File Caching<a class="headerlink" href="#manifest-file-caching" title="Permalink to this heading">#</a></h3>
<p>As of Iceberg version 1.1.0, Apache Iceberg provides a mechanism to cache the contents of Iceberg manifest files in memory. This feature helps
to reduce repeated reads of small Iceberg manifest files from remote storage.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently, manifest file caching is supported for Hadoop and Nessie catalogs in the Presto Iceberg connector.</p>
</div>
<p>The following configuration properties are available:</p>
<table>
<thead>
<tr class="row-odd"><th class="head"><p>Property Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.io.manifest.cache-enabled</span></code></p></td>
<td><p>Enable or disable the manifest caching feature. This feature
is only available if <code class="docutils literal notranslate"><span class="pre">iceberg.catalog.type</span></code> is <code class="docutils literal notranslate"><span class="pre">hadoop</span></code>
or <code class="docutils literal notranslate"><span class="pre">nessie</span></code>.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">false</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.io-impl</span></code></p></td>
<td><p>Custom FileIO implementation to use in a catalog. It must
be set to enable manifest caching.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">org.apache.iceberg.hadoop.HadoopFileIO</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.io.manifest.cache.max-total-bytes</span></code></p></td>
<td><p>Maximum size of cache size in bytes.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">104857600</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.io.manifest.cache.expiration-interval-ms</span></code></p></td>
<td><p>Maximum time duration in milliseconds for which an entry
stays in the manifest cache.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">60000</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">iceberg.io.manifest.cache.max-content-length</span></code></p></td>
<td><p>Maximum length of a manifest file to be considered for
caching in bytes. Manifest files with a length exceeding
this size will not be cached.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">8388608</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="alluxio-data-cache">
<h3 id="alluxio-data-cache">Alluxio Data Cache<a class="headerlink" href="#alluxio-data-cache" title="Permalink to this heading">#</a></h3>
<p>A Presto worker caches remote storage data in its original form (compressed and possibly encrypted) on local SSD upon read.</p>
<p>The following configuration properties are required to set in the Iceberg catalog file (catalog/iceberg.properties):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cache.enabled=true
cache.base-directory=file:///mnt/flash/data
cache.type=ALLUXIO
cache.alluxio.max-cache-size=1600GB
hive.node-selection-strategy=SOFT_AFFINITY
</pre></div>
</div>
<p>JMX queries to get the metrics and verify the cache usage:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">jmx</span><span class="p">.</span><span class="k">current</span><span class="p">.</span><span class="ss">"com.facebook.alluxio:name=client.cachehitrate,type=gauges"</span><span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">jmx</span><span class="p">.</span><span class="k">current</span><span class="p">.</span><span class="ss">"com.facebook.alluxio:name=client.cachebytesreadcache,type=meters"</span><span class="p">;</span>

<span class="k">SHOW</span><span class="w"> </span><span class="n">TABLES</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">jmx</span><span class="p">.</span><span class="k">current</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">'%alluxio%'</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="file-and-stripe-footer-cache">
<h3 id="file-and-stripe-footer-cache">File And Stripe Footer Cache<a class="headerlink" href="#file-and-stripe-footer-cache" title="Permalink to this heading">#</a></h3>
<p>Caches open file descriptors and stripe or file footer information in leaf worker memory. These pieces of data are mostly frequently accessed when reading files.</p>
<p>The following configuration properties are required to set in the Iceberg catalog file (catalog/iceberg.properties):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># scheduling
hive.node-selection-strategy=SOFT_AFFINITY

# orc
iceberg.orc.file-tail-cache-enabled=true
iceberg.orc.file-tail-cache-size=100MB
iceberg.orc.file-tail-cache-ttl-since-last-access=6h
iceberg.orc.stripe-metadata-cache-enabled=true
iceberg.orc.stripe-footer-cache-size=100MB
iceberg.orc.stripe-footer-cache-ttl-since-last-access=6h
iceberg.orc.stripe-stream-cache-size=300MB
iceberg.orc.stripe-stream-cache-ttl-since-last-access=6h

# parquet
iceberg.parquet.metadata-cache-enabled=true
iceberg.parquet.metadata-cache-size=100MB
iceberg.parquet.metadata-cache-ttl-since-last-access=6h
</pre></div>
</div>
<p>JMX queries to get the metrics and verify the cache usage:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">jmx</span><span class="p">.</span><span class="k">current</span><span class="p">.</span><span class="ss">"com.facebook.presto.hive:name=iceberg_parquetmetadata,type=cachestatsmbean"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="metastore-versioned-cache">
<h3 id="metastore-versioned-cache">Metastore Versioned Cache<a class="headerlink" href="#metastore-versioned-cache" title="Permalink to this heading">#</a></h3>
<p>Metastore cache only caches schema and table names. Other metadata would be fetched from the filesystem.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Metastore Versioned Cache would be applicable only for Hive Catalog in the Presto Iceberg connector.</p>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>hive.metastore-cache-ttl=2d
hive.metastore-refresh-interval=3d
hive.metastore-cache-maximum-size=10000000
</pre></div>
</div>
</section>
</section>
<section id="extra-hidden-metadata-columns">
<h2 id="extra-hidden-metadata-columns">Extra Hidden Metadata Columns<a class="headerlink" href="#extra-hidden-metadata-columns" title="Permalink to this heading">#</a></h2>
<p>The Iceberg connector exposes extra hidden metadata columns. You can query these
as part of a SQL query by including them in your SELECT statement.</p>
<section id="path-column">
<h3 id="path-column"><code class="docutils literal notranslate"><span class="pre">$path</span></code> column<a class="headerlink" href="#path-column" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$path</span></code>: Full file system path name of the file for this row</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="ss">"$path"</span><span class="p">,</span><span class="w"> </span><span class="n">regionkey</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="ss">"ctas_nation"</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>        $path                    |  regionkey
---------------------------------+-----------
 /full/path/to/file/file.parquet | 2
</pre></div>
</div>
</section>
<section id="data-sequence-number-column">
<h3 id="data-sequence-number-column"><code class="docutils literal notranslate"><span class="pre">$data_sequence_number</span></code> column<a class="headerlink" href="#data-sequence-number-column" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$data_sequence_number</span></code>: The Iceberg data sequence number in which this row was added</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="ss">"$data_sequence_number"</span><span class="p">,</span><span class="w"> </span><span class="n">regionkey</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="ss">"ctas_nation"</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>        $data_sequence_number     |  regionkey
----------------------------------+------------
             2                    | 3
</pre></div>
</div>
</section>
</section>
<section id="extra-hidden-metadata-tables">
<h2 id="extra-hidden-metadata-tables">Extra Hidden Metadata Tables<a class="headerlink" href="#extra-hidden-metadata-tables" title="Permalink to this heading">#</a></h2>
<p>The Iceberg connector exposes extra hidden metadata tables. You can query these
as a part of a SQL query by appending name to the table.</p>
<section id="properties-table">
<h3 id="properties-table"><code class="docutils literal notranslate"><span class="pre">$properties</span></code> Table<a class="headerlink" href="#properties-table" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$properties</span></code> : General properties of the given table</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="ss">"ctas_nation$properties"</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>        key           |  value
----------------------+---------
 write.format.default | PARQUET
</pre></div>
</div>
</section>
<section id="history-table">
<h3 id="history-table"><code class="docutils literal notranslate"><span class="pre">$history</span></code> Table<a class="headerlink" href="#history-table" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$history</span></code> : History of table state changes</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="ss">"ctas_nation$history"</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>           made_current_at            |     snapshot_id     | parent_id | is_current_ancestor
--------------------------------------+---------------------+-----------+---------------------
2022-11-25 20:56:31.784 Asia/Kolkata  | 7606232158543069775 | NULL      | true
</pre></div>
</div>
</section>
<section id="snapshots-table">
<h3 id="snapshots-table"><code class="docutils literal notranslate"><span class="pre">$snapshots</span></code> Table<a class="headerlink" href="#snapshots-table" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$snapshots</span></code> : Details about the table snapshots. For more information see <a class="reference external" href="https://iceberg.apache.org/spec/#snapshots">Snapshots</a> in the Iceberg Table Spec.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="ss">"ctas_nation$snapshots"</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>             committed_at             |     snapshot_id     | parent_id | operation |                                                  manifest_list                                           |                                                                                 summary
--------------------------------------+---------------------+-----------+-----------+----------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
2022-11-25 20:56:31.784 Asia/Kolkata  | 7606232158543069775 | NULL      | append    | s3://my-bucket/ctas_nation/metadata/snap-7606232158543069775-1-395a2cad-b244-409b-b030-cc44949e5a4e.avro | {changed-partition-count=1, added-data-files=1, total-equality-deletes=0, added-records=25, total-position-deletes=0, added-files-size=1648, total-delete-files=0, total-files-size=1648, total-records=25, total-data-files=1}
</pre></div>
</div>
</section>
<section id="manifests-table">
<h3 id="manifests-table"><code class="docutils literal notranslate"><span class="pre">$manifests</span></code> Table<a class="headerlink" href="#manifests-table" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$manifests</span></code> : Details about the manifests of different table snapshots. For more information see <a class="reference external" href="https://iceberg.apache.org/spec/#manifests">Manifests</a> in the Iceberg Table Spec.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="ss">"ctas_nation$manifests"</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                                           path                                  | length | partition_spec_id |  added_snapshot_id  | added_data_files_count | existing_data_files_count | deleted_data_files_count | partitions
---------------------------------------------------------------------------------+--------+-------------------+---------------------+------------------------+---------------------------+--------------------------+-----------
s3://my-bucket/ctas_nation/metadata/395a2cad-b244-409b-b030-cc44949e5a4e-m0.avro |   5957 |                 0 | 7606232158543069775 |                      1 |                         0 |                    0     |    []
</pre></div>
</div>
</section>
<section id="partitions-table">
<h3 id="partitions-table"><code class="docutils literal notranslate"><span class="pre">$partitions</span></code> Table<a class="headerlink" href="#partitions-table" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$partitions</span></code> : Detailed partition information for the table</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="ss">"ctas_nation$partitions"</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> row_count | file_count | total_size |           nationkey           |                   name                   |          regionkey           |                          comment
-----------+------------+------------+-------------------------------+------------------------------------------+------------------------------+------------------------------------------------------------
    25     |          1 |       1648 | {min=0, max=24, null_count=0} | {min=ALGERIA, max=VIETNAM, null_count=0} | {min=0, max=4, null_count=0} | {min= haggle. careful, max=y final packaget, null_count=0}
</pre></div>
</div>
</section>
<section id="files-table">
<h3 id="files-table"><code class="docutils literal notranslate"><span class="pre">$files</span></code> Table<a class="headerlink" href="#files-table" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$files</span></code> : Overview of data files in the current snapshot of the table</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="ss">"ctas_nation$files"</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> content |                                      file_path                               | file_format | record_count | file_size_in_bytes |        column_sizes         |       value_counts       |  null_value_counts   | nan_value_counts |          lower_bounds                     |             upper_bounds                   | key_metadata | split_offsets | equality_ids
---------+------------------------------------------------------------------------------+-------------+--------------+--------------------+-----------------------------+--------------------------+----------------------+------------------+-------------------------------------------+--------------------------------------------+--------------+---------------+-------------
   0     | s3://my-bucket/ctas_nation/data/9f889274-6f74-4d28-8164-275eef99f660.parquet | PARQUET     |           25 |               1648 | {1=52, 2=222, 3=105, 4=757} | {1=25, 2=25, 3=25, 4=25} | {1=0, 2=0, 3=0, 4=0} |  NULL            | {1=0, 2=ALGERIA, 3=0, 4= haggle. careful} | {1=24, 2=VIETNAM, 3=4, 4=y final packaget} | NULL         | NULL          | NULL
</pre></div>
</div>
</section>
<section id="changelog-table">
<h3 id="changelog-table"><code class="docutils literal notranslate"><span class="pre">$changelog</span></code> Table<a class="headerlink" href="#changelog-table" title="Permalink to this heading">#</a></h3>
<p>This table lets you view which row-level changes have occurred to the table in a
particular order over time. The <code class="docutils literal notranslate"><span class="pre">$changelog</span></code> table represents the history of
changes to the table, while also making the data available to process through a
query.</p>
<p>The result of a changelog query always returns a static schema with four
columns:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">operation</span></code>: (<code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code>) indicating whether the row was inserted,
updated, or deleted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ordinal</span></code>: (<code class="docutils literal notranslate"><span class="pre">int</span></code>) A number indicating a relative order that a particular
change needs to be applied to the table relative to all other changes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">snapshotid</span></code>: (<code class="docutils literal notranslate"><span class="pre">bigint</span></code>) Represents the snapshot a row-level
change was made in.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rowdata</span></code>: (<code class="docutils literal notranslate"><span class="pre">row(T)</span></code>) which includes the data for the particular row. The
inner values of this type match the schema of the parent table.</p></li>
</ol>
<p>The changelog table can be queried with the following name format:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="p">...</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="ss">"&lt;table&gt;[@&lt;begin snapshot ID&gt;]$changelog[@&lt;end snapshot ID&gt;]"</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;table&gt;</span></code> is the name of the table.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;begin</span> <span class="pre">snapshot</span> <span class="pre">ID&gt;</span></code> is the snapshot of the table you want to begin viewing
changes from. This parameter is optional. If absent, the oldest available
snapshot is used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;end</span> <span class="pre">snapshot</span> <span class="pre">ID&gt;</span></code> is the last snapshot for which you want to view changes.
This parameter is optional. If absent, the most current snapshot of the
table is used.</p></li>
</ul>
<p>One use for the <code class="docutils literal notranslate"><span class="pre">$changelog</span></code> table would be to find when a record was inserted
or removed from the table. To accomplish this, the  <code class="docutils literal notranslate"><span class="pre">$changelog</span></code> table can be
used in conjunction with the <code class="docutils literal notranslate"><span class="pre">$snapshots</span></code> table. First, choose a snapshot ID
from the <code class="docutils literal notranslate"><span class="pre">$snapshots</span></code> table to choose the starting point.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="ss">"orders$snapshots"</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                committed_at                 |     snapshot_id     |      parent_id      | operation |                                                                                       manifest_list                                                                                        |                                                                                                              summary
---------------------------------------------+---------------------+---------------------+-----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 2023-09-26 08:45:20.930 America/Los_Angeles | 2423571386296047175 | NULL                | append    | file:/var/folders/g_/6_hxl7r16qdddw7956j_r88h0000gn/T/PrestoTest8140889264166671718/catalog/tpch/ctas_orders/metadata/snap-2423571386296047175-1-3f288b1c-95a9-406b-9e17-9cfe31a11b48.avro | {changed-partition-count=1, added-data-files=4, total-equality-deletes=0, added-records=100, total-position-deletes=0, added-files-size=9580, total-delete-files=0, total-files-size=9580, total-records=100, total-data-files=4}
 2023-09-26 08:45:36.942 America/Los_Angeles | 8702997868627997320 | 2423571386296047175 | append    | file:/var/folders/g_/6_hxl7r16qdddw7956j_r88h0000gn/T/PrestoTest8140889264166671718/catalog/tpch/ctas_orders/metadata/snap-8702997868627997320-1-a2e1c714-7eed-4e2c-b144-dae4147ebaa4.avro | {changed-partition-count=1, added-data-files=1, total-equality-deletes=0, added-records=1, total-position-deletes=0, added-files-size=1687, total-delete-files=0, total-files-size=11267, total-records=101, total-data-files=5}
 2023-09-26 08:45:39.866 America/Los_Angeles | 7615903782581283889 | 8702997868627997320 | append    | file:/var/folders/g_/6_hxl7r16qdddw7956j_r88h0000gn/T/PrestoTest8140889264166671718/catalog/tpch/ctas_orders/metadata/snap-7615903782581283889-1-d94c2114-fd22-4de2-9ab5-c0b5bf67282f.avro | {changed-partition-count=1, added-data-files=3, total-equality-deletes=0, added-records=3, total-position-deletes=0, added-files-size=4845, total-delete-files=0, total-files-size=16112, total-records=104, total-data-files=8}
 2023-09-26 08:45:48.404 America/Los_Angeles |  677209275408372885 | 7615903782581283889 | append    | file:/var/folders/g_/6_hxl7r16qdddw7956j_r88h0000gn/T/PrestoTest8140889264166671718/catalog/tpch/ctas_orders/metadata/snap-677209275408372885-1-ad69e208-1440-459b-93e8-48e61f961758.avro  | {changed-partition-count=1, added-data-files=3, total-equality-deletes=0, added-records=5, total-position-deletes=0, added-files-size=4669, total-delete-files=0, total-files-size=20781, total-records=109, total-data-files=11}
</pre></div>
</div>
<p>Now that we know the snapshots available to query in the changelog, we can see
what changes were made to the table since it was created. Specifically, this
example uses the earliest snapshot ID: <code class="docutils literal notranslate"><span class="pre">2423571386296047175</span></code></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="ss">"ctas_orders@2423571386296047175$changelog"</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ordinal</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> operation | ordinal |     snapshotid      |                                                                                                                   rowdata
-----------+---------+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 INSERT    |       0 | 8702997868627997320 | {orderkey=37504, custkey=1291, orderstatus=O, totalprice=165509.83, orderdate=1996-03-04, orderpriority=5-LOW, clerk=Clerk#000000871, shippriority=0, comment=c theodolites alongside of the fluffily bold requests haggle quickly against }
 INSERT    |       1 | 7615903782581283889 | {orderkey=12001, custkey=739, orderstatus=F, totalprice=138635.75, orderdate=1994-07-07, orderpriority=2-HIGH, clerk=Clerk#000000863, shippriority=0, comment=old, even theodolites. regular, special theodolites use furio}
 INSERT    |       1 | 7615903782581283889 | {orderkey=17989, custkey=364, orderstatus=F, totalprice=133669.05, orderdate=1994-01-17, orderpriority=4-NOT SPECIFIED, clerk=Clerk#000000547, shippriority=0, comment=ously express excuses. even theodolit}
 INSERT    |       1 | 7615903782581283889 | {orderkey=37504, custkey=1291, orderstatus=O, totalprice=165509.83, orderdate=1996-03-04, orderpriority=5-LOW, clerk=Clerk#000000871, shippriority=0, comment=c theodolites alongside of the fluffily bold requests haggle quickly against }
 INSERT    |       2 |  677209275408372885 | {orderkey=17991, custkey=92, orderstatus=O, totalprice=20732.51, orderdate=1998-07-09, orderpriority=4-NOT SPECIFIED, clerk=Clerk#000000636, shippriority=0, comment= the quickly express accounts. iron}
 INSERT    |       2 |  677209275408372885 | {orderkey=17989, custkey=364, orderstatus=F, totalprice=133669.05, orderdate=1994-01-17, orderpriority=4-NOT SPECIFIED, clerk=Clerk#000000547, shippriority=0, comment=ously express excuses. even theodolit}
 INSERT    |       2 |  677209275408372885 | {orderkey=17990, custkey=458, orderstatus=O, totalprice=218031.58, orderdate=1998-03-18, orderpriority=3-MEDIUM, clerk=Clerk#000000340, shippriority=0, comment=ounts wake final foxe}
 INSERT    |       2 |  677209275408372885 | {orderkey=18016, custkey=403, orderstatus=O, totalprice=174070.99, orderdate=1996-03-19, orderpriority=1-URGENT, clerk=Clerk#000000629, shippriority=0, comment=ly. quickly ironic excuses are furiously. carefully ironic pack}
 INSERT    |       2 |  677209275408372885 | {orderkey=18017, custkey=958, orderstatus=F, totalprice=203091.02, orderdate=1993-03-26, orderpriority=1-URGENT, clerk=Clerk#000000830, shippriority=0, comment=sleep quickly bold requests. slyly pending pinto beans haggle in pla}
</pre></div>
</div>
</section>
</section>
<section id="sql-support">
<h2 id="sql-support">SQL Support<a class="headerlink" href="#sql-support" title="Permalink to this heading">#</a></h2>
<p>The Iceberg connector supports querying and manipulating Iceberg tables and schemas
(databases). Here are some examples of the SQL operations supported by Presto:</p>
<section id="create-schema">
<h3 id="create-schema">CREATE SCHEMA<a class="headerlink" href="#create-schema" title="Permalink to this heading">#</a></h3>
<p>Create a new Iceberg schema named <code class="docutils literal notranslate"><span class="pre">web</span></code> that stores tables in an
S3 bucket named <code class="docutils literal notranslate"><span class="pre">my-bucket</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="k">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'s3://my-bucket/'</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create-table">
<h3 id="create-table">CREATE TABLE<a class="headerlink" href="#create-table" title="Permalink to this heading">#</a></h3>
<p>Create a new Iceberg table named <code class="docutils literal notranslate"><span class="pre">page_views</span></code> in the <code class="docutils literal notranslate"><span class="pre">web</span></code> schema
that is stored using the ORC file format, partitioned by <code class="docutils literal notranslate"><span class="pre">ds</span></code> and
<code class="docutils literal notranslate"><span class="pre">country</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">view_time</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span>
<span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span>
<span class="w">  </span><span class="n">page_url</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">  </span><span class="n">ds</span><span class="w"> </span><span class="nb">date</span><span class="p">,</span>
<span class="w">  </span><span class="n">country</span><span class="w"> </span><span class="nb">varchar</span>
<span class="p">)</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ORC'</span><span class="p">,</span>
<span class="w">  </span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'ds'</span><span class="p">,</span><span class="w"> </span><span class="s1">'country'</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Create an Iceberg table with Iceberg format version 2:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views_v2</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">view_time</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span>
<span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">bigint</span><span class="p">,</span>
<span class="w">  </span><span class="n">page_url</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">  </span><span class="n">ds</span><span class="w"> </span><span class="nb">date</span><span class="p">,</span>
<span class="w">  </span><span class="n">country</span><span class="w"> </span><span class="nb">varchar</span>
<span class="p">)</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ORC'</span><span class="p">,</span>
<span class="w">  </span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'ds'</span><span class="p">,</span><span class="w"> </span><span class="s1">'country'</span><span class="p">],</span>
<span class="w">  </span><span class="n">format_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'2'</span>
<span class="p">)</span>
</pre></div>
</div>
<section id="partition-column-transform">
<h4 id="partition-column-transform">Partition Column Transform<a class="headerlink" href="#partition-column-transform" title="Permalink to this heading">#</a></h4>
<p>Beyond selecting some particular columns for partitioning, you can use the <code class="docutils literal notranslate"><span class="pre">transform</span></code> functions and partition the table
by the transformed value of the column.</p>
<p>Available transforms in the Presto Iceberg connector include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Bucket</span></code> (partitions data into a specified number of buckets using a hash function)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Truncate</span></code> (partitions the table based on the truncated value of the field and can specify the width of the truncated value)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Identity</span></code> (partitions data using unmodified source value)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Year</span></code> (partitions data using integer value by extracting a date or timestamp year, as years from 1970)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Month</span></code> (partitions data using integer value by extracting a date or timestamp month, as months from 1970-01-01)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Day</span></code> (partitions data using integer value by extracting a date or timestamp day, as days from 1970-01-01)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Hour</span></code> (partitions data using integer value by extracting a timestamp hour, as hours from 1970-01-01 00:00:00)</p></li>
</ul>
<p>Create an Iceberg table partitioned into 8 buckets of equal size ranges:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">players</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">    </span><span class="n">team</span><span class="w"> </span><span class="nb">varchar</span>
<span class="p">)</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ORC'</span><span class="p">,</span>
<span class="w">    </span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'bucket(team, 8)'</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Create an Iceberg table partitioned by the first letter of the <code class="docutils literal notranslate"><span class="pre">team</span></code> field:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">players</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">    </span><span class="n">team</span><span class="w"> </span><span class="nb">varchar</span>
<span class="p">)</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ORC'</span><span class="p">,</span>
<span class="w">    </span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'truncate(team, 1)'</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Create an Iceberg table partitioned by <code class="docutils literal notranslate"><span class="pre">ds</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">players</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">    </span><span class="n">team</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">    </span><span class="n">ds</span><span class="w"> </span><span class="nb">date</span>
<span class="p">)</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ORC'</span><span class="p">,</span>
<span class="w">    </span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'year(ds)'</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Create an Iceberg table partitioned by <code class="docutils literal notranslate"><span class="pre">ts</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">players</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">    </span><span class="n">team</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span>
<span class="w">    </span><span class="n">ts</span><span class="w"> </span><span class="k">timestamp</span>
<span class="p">)</span>
<span class="k">WITH</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ORC'</span><span class="p">,</span>
<span class="w">    </span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ARRAY</span><span class="p">[</span><span class="s1">'hour(ts)'</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="create-view">
<h3 id="create-view">CREATE VIEW<a class="headerlink" href="#create-view" title="Permalink to this heading">#</a></h3>
<p>The Iceberg connector supports creating views in Hive and Glue metastores.
To create a view named <code class="docutils literal notranslate"><span class="pre">view_page_views</span></code> for the <code class="docutils literal notranslate"><span class="pre">iceberg.web.page_views</span></code> table created in the <a class="reference internal" href="#create-table">CREATE TABLE</a> example:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">view_page_views</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="insert-into">
<h3 id="insert-into">INSERT INTO<a class="headerlink" href="#insert-into" title="Permalink to this heading">#</a></h3>
<p>Insert data into the <code class="docutils literal notranslate"><span class="pre">page_views</span></code> table:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="s1">'2023-08-12 03:04:05.321'</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'https://example.com'</span><span class="p">,</span><span class="w"> </span><span class="k">current_date</span><span class="p">,</span><span class="w"> </span><span class="s1">'country'</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="create-table-as-select">
<h3 id="create-table-as-select">CREATE TABLE AS SELECT<a class="headerlink" href="#create-table-as-select" title="Permalink to this heading">#</a></h3>
<p>Create a new table <code class="docutils literal notranslate"><span class="pre">page_views_new</span></code> from an existing table <code class="docutils literal notranslate"><span class="pre">page_views</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views_new</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span>
</pre></div>
</div>
</section>
<section id="select">
<h3 id="select">SELECT<a class="headerlink" href="#select" title="Permalink to this heading">#</a></h3>
<p>SELECT table operations are supported for Iceberg format version 1 and version 2 in the connector:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views_v2</span><span class="p">;</span>
</pre></div>
</div>
<section id="table-with-delete-files">
<h4 id="table-with-delete-files">Table with delete files<a class="headerlink" href="#table-with-delete-files" title="Permalink to this heading">#</a></h4>
<p>Iceberg V2 tables support row-level deletion. For more information see
<a class="reference external" href="https://iceberg.apache.org/spec/#row-level-deletes">Row-level deletes</a> in the Iceberg Table Spec.
Presto supports reading delete files, including Position Delete Files and Equality Delete Files.
When reading, Presto merges these delete files to read the latest results.</p>
</section>
</section>
<section id="alter-table">
<h3 id="alter-table">ALTER TABLE<a class="headerlink" href="#alter-table" title="Permalink to this heading">#</a></h3>
<p>Alter table operations are supported in the Iceberg connector:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">zipcode</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">;</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="w"> </span><span class="k">RENAME</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">zipcode</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">location</span><span class="p">;</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="k">location</span><span class="p">;</span>
</pre></div>
</div>
<p>To add a new column as a partition column, identify the transform functions for the column.
The table is partitioned by the transformed value of the column:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">zipcode</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'identity'</span><span class="p">);</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="k">location</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'truncate(2)'</span><span class="p">);</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="k">location</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'bucket(8)'</span><span class="p">);</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="nb">date</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'year'</span><span class="p">);</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">ts</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'month'</span><span class="p">);</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="nb">date</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'day'</span><span class="p">);</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">ts</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="p">(</span><span class="n">partitioning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'hour'</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="truncate">
<h3 id="truncate">TRUNCATE<a class="headerlink" href="#truncate" title="Permalink to this heading">#</a></h3>
<p>The Iceberg connector can delete all of the data from tables without
dropping the table from the metadata catalog using <code class="docutils literal notranslate"><span class="pre">TRUNCATE</span> <span class="pre">TABLE</span></code>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">TRUNCATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">nation</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>TRUNCATE TABLE;
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">nation</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> nationkey | name | regionkey | comment
-----------+------+-----------+---------
(0 rows)
</pre></div>
</div>
</section>
<section id="delete">
<h3 id="delete">DELETE<a class="headerlink" href="#delete" title="Permalink to this heading">#</a></h3>
<p>The Iceberg connector can delete data in one or more entire partitions from tables by using <code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">FROM</span></code>. For example, to delete from the table <code class="docutils literal notranslate"><span class="pre">lineitem</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">lineitem</span><span class="p">;</span>

<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">lineitem</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">linenumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">lineitem</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">linenumber</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">linestatus</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="s1">'O'</span><span class="p">,</span><span class="w"> </span><span class="s1">'F'</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Columns in the filter must all be identity transformed partition columns of the target table.</p>
<p>Filtered columns only support comparison operators, such as EQUALS, LESS THAN, or LESS THAN EQUALS.</p>
<p>Deletes must only occur on the latest snapshot.</p>
</div>
</section>
<section id="drop-table">
<h3 id="drop-table">DROP TABLE<a class="headerlink" href="#drop-table" title="Permalink to this heading">#</a></h3>
<p>Drop the table <code class="docutils literal notranslate"><span class="pre">page_views</span></code></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">page_views</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Dropping an Iceberg table with Hive Metastore and Glue catalogs only removes metadata from metastore.</p></li>
<li><p>Dropping an Iceberg table with Hadoop and Nessie catalogs removes all the data and metadata in the table.</p></li>
</ul>
</section>
<section id="drop-view">
<h3 id="drop-view">DROP VIEW<a class="headerlink" href="#drop-view" title="Permalink to this heading">#</a></h3>
<p>Drop the view <code class="docutils literal notranslate"><span class="pre">view_page_views</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DROP</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span><span class="p">.</span><span class="n">view_page_views</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="drop-schema">
<h3 id="drop-schema">DROP SCHEMA<a class="headerlink" href="#drop-schema" title="Permalink to this heading">#</a></h3>
<p>Drop the schema <code class="docutils literal notranslate"><span class="pre">iceberg.web</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DROP</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">web</span>
</pre></div>
</div>
</section>
<section id="register-table">
<h3 id="register-table">Register table<a class="headerlink" href="#register-table" title="Permalink to this heading">#</a></h3>
<p>Iceberg tables for which table data and metadata already exist in the
file system can be registered with the catalog using the <code class="docutils literal notranslate"><span class="pre">register_table</span></code>
procedure on the catalogâ€™s <code class="docutils literal notranslate"><span class="pre">system</span></code> schema by supplying the target schema,
desired table name, and the location of the table metadata:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CALL</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">register_table</span><span class="p">(</span><span class="s1">'schema_name'</span><span class="p">,</span><span class="w"> </span><span class="s1">'table_name'</span><span class="p">,</span><span class="w"> </span><span class="s1">'hdfs://localhost:9000/path/to/iceberg/table/metadata/dir'</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If multiple metadata files of the same version exist at the specified
location, the most recently modified one will be used.</p>
</div>
<p>A metadata file can optionally be included as an argument to <code class="docutils literal notranslate"><span class="pre">register_table</span></code>
in the case where a specific metadata file contains the targeted table state:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CALL</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">register_table</span><span class="p">(</span><span class="s1">'schema_name'</span><span class="p">,</span><span class="w"> </span><span class="s1">'table_name'</span><span class="p">,</span><span class="w"> </span><span class="s1">'hdfs://localhost:9000/path/to/iceberg/table/metadata/dir'</span><span class="p">,</span><span class="w"> </span><span class="s1">'00000-35a08aed-f4b0-4010-95d2-9d73ef4be01c.metadata.json'</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When registering a table with the Hive metastore, the user calling the
procedure will be set as the owner of the table and will have <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>,
<code class="docutils literal notranslate"><span class="pre">INSERT</span></code>, <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>, and <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> privileges for that table. These
privileges can be altered using the <code class="docutils literal notranslate"><span class="pre">GRANT</span></code> and <code class="docutils literal notranslate"><span class="pre">REVOKE</span></code> commands.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using the Hive catalog, attempts to read registered Iceberg tables
using the Hive connector will fail.</p>
</div>
</section>
<section id="unregister-table">
<h3 id="unregister-table">Unregister table<a class="headerlink" href="#unregister-table" title="Permalink to this heading">#</a></h3>
<p>Iceberg tables can be unregistered from the catalog using the <code class="docutils literal notranslate"><span class="pre">unregister_table</span></code>
procedure on the catalogâ€™s <code class="docutils literal notranslate"><span class="pre">system</span></code> schema:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CALL</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">unregister_table</span><span class="p">(</span><span class="s1">'schema_name'</span><span class="p">,</span><span class="w"> </span><span class="s1">'table_name'</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Table data and metadata will remain in the filesystem after a call to
<code class="docutils literal notranslate"><span class="pre">unregister_table</span></code> only when using the Hive catalog. This is similar to
the behavior listed above for the <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TABLE</span></code> command.</p>
</div>
</section>
</section>
<section id="schema-evolution">
<h2 id="schema-evolution">Schema Evolution<a class="headerlink" href="#schema-evolution" title="Permalink to this heading">#</a></h2>
<p>Iceberg and Presto Iceberg connector support in-place table evolution, also known as
schema evolution, such as adding, dropping, and renaming columns. With schema
evolution, users can evolve a table schema with SQL after enabling the Presto
Iceberg connector.</p>
</section>
<section id="parquet-writer-version">
<h2 id="parquet-writer-version">Parquet Writer Version<a class="headerlink" href="#parquet-writer-version" title="Permalink to this heading">#</a></h2>
<p>Presto now supports Parquet writer versions V1 and V2 for the Iceberg catalog.
It can be toggled using the session property <code class="docutils literal notranslate"><span class="pre">parquet_writer_version</span></code> and the config property <code class="docutils literal notranslate"><span class="pre">hive.parquet.writer.version</span></code>.
Valid values for these properties are <code class="docutils literal notranslate"><span class="pre">PARQUET_1_0</span></code> and <code class="docutils literal notranslate"><span class="pre">PARQUET_2_0</span></code>. Default is <code class="docutils literal notranslate"><span class="pre">PARQUET_2_0</span></code>.</p>
<section id="example-queries">
<h3 id="example-queries">Example Queries<a class="headerlink" href="#example-queries" title="Permalink to this heading">#</a></h3>
<p>Letâ€™s create an Iceberg table named <cite>ctas_nation</cite>, created from the TPCH <cite>nation</cite>
table. The table has four columns: <cite>nationkey</cite>, <cite>name</cite>, <cite>regionkey</cite>, and <cite>comment</cite>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">USE</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">tpch</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">nation</span><span class="p">);</span>
<span class="k">DESCRIBE</span><span class="w"> </span><span class="n">ctas_nation</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  Column   |  Type   | Extra | Comment
-----------+---------+-------+---------
 nationkey | bigint  |       |
 name      | varchar |       |
 regionkey | bigint  |       |
 comment   | varchar |       |
(4 rows)
</pre></div>
</div>
<p>We can simply add a new column to the Iceberg table by using <cite>ALTER TABLE</cite>
statement. The following query adds a new column named <cite>zipcode</cite> to the table.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">zipcode</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">;</span>
<span class="k">DESCRIBE</span><span class="w"> </span><span class="n">ctas_nation</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  Column   |  Type   | Extra | Comment
-----------+---------+-------+---------
 nationkey | bigint  |       |
 name      | varchar |       |
 regionkey | bigint  |       |
 comment   | varchar |       |
 zipcode   | varchar |       |
(5 rows)
</pre></div>
</div>
<p>We can also rename the new column to another name, <cite>address</cite>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">RENAME</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">zipcode</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">address</span><span class="p">;</span>
<span class="k">DESCRIBE</span><span class="w"> </span><span class="n">ctas_nation</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  Column   |  Type   | Extra | Comment
-----------+---------+-------+---------
 nationkey | bigint  |       |
 name      | varchar |       |
 regionkey | bigint  |       |
 comment   | varchar |       |
 address  | varchar |       |
(5 rows)
</pre></div>
</div>
<p>Finally, we can delete the new column. The table columns will be restored to the
original state.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">address</span><span class="p">;</span>
<span class="k">DESCRIBE</span><span class="w"> </span><span class="n">ctas_nation</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  Column   |  Type   | Extra | Comment
-----------+---------+-------+---------
 nationkey | bigint  |       |
 name      | varchar |       |
 regionkey | bigint  |       |
 comment   | varchar |       |
(4 rows)
</pre></div>
</div>
</section>
</section>
<section id="time-travel">
<h2 id="time-travel">Time Travel<a class="headerlink" href="#time-travel" title="Permalink to this heading">#</a></h2>
<p>Iceberg and Presto Iceberg connector support time travel via table snapshots
identified by unique snapshot IDs. The snapshot IDs are stored in the <code class="docutils literal notranslate"><span class="pre">$snapshots</span></code>
metadata table. You can rollback the state of a table to a previous snapshot ID.
It also supports time travel query using VERSION (SYSTEM_VERSION) and TIMESTAMP (SYSTEM_TIME) options.</p>
<section id="id1">
<h3 id="id1">Example Queries<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>Similar to the example queries in <a class="reference internal" href="#schema-evolution">SCHEMA EVOLUTION</a>, create an Iceberg
table named <cite>ctas_nation</cite> from the TPCH <cite>nation</cite> table:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="p">..</span><span class="w"> </span><span class="n">code</span><span class="o">-</span><span class="n">block</span><span class="p">::</span><span class="w"> </span><span class="k">sql</span>
</pre></div>
</div>
<blockquote>
<div><p>USE iceberg.tpch;
CREATE TABLE IF NOT EXISTS ctas_nation AS (SELECT * FROM nation);
DESCRIBE ctas_nation;</p>
</div></blockquote>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  Column   |  Type   | Extra | Comment
-----------+---------+-------+---------
 nationkey | bigint  |       |
 name      | varchar |       |
 regionkey | bigint  |       |
 comment   | varchar |       |
(4 rows)
</pre></div>
</div>
<p>We can find snapshot IDs for the Iceberg table from the <cite>$snapshots</cite> metadata table.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">snapshot_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">tpch</span><span class="p">.</span><span class="ss">"ctas_nation$snapshots"</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">committed_at</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>     snapshot_id
---------------------
 5837462824399906536
(1 row)
</pre></div>
</div>
<p>For now, as weâ€™ve just created the table, thereâ€™s only one snapshot ID. Letâ€™s
insert one row into the table and see the change in the snapshot IDs.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="s1">'new country'</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'comment'</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">snapshot_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="n">tpch</span><span class="p">.</span><span class="ss">"ctas_nation$snapshots"</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">committed_at</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>     snapshot_id
---------------------
 5837462824399906536
 5140039250977437531
(2 rows)
</pre></div>
</div>
<p>Now thereâ€™s a new snapshot (<cite>5140039250977437531</cite>) created as a new row is
inserted into the table. The new row can be verified by running</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'new country'</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> nationkey |    name     | regionkey | comment
-----------+-------------+-----------+---------
        25 | new country |         1 | comment
(1 row)
</pre></div>
</div>
<p>With the time travel feature, we can rollback to the previous state without the
new row by calling <cite>iceberg.system.rollback_to_snapshot</cite>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CALL</span><span class="w"> </span><span class="n">iceberg</span><span class="p">.</span><span class="k">system</span><span class="p">.</span><span class="n">rollback_to_snapshot</span><span class="p">(</span><span class="s1">'tpch'</span><span class="p">,</span><span class="w"> </span><span class="s1">'ctas_nation'</span><span class="p">,</span><span class="w"> </span><span class="mi">5837462824399906536</span><span class="p">);</span>
</pre></div>
</div>
<p>Now if we check the table again, weâ€™ll find that the newly inserted row no longer
exists as weâ€™ve rolled back to the previous state.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'new country'</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> nationkey | name | regionkey | comment
-----------+------+-----------+---------
(0 rows)
</pre></div>
</div>
</section>
<section id="time-travel-using-version-system-version-and-timestamp-system-time">
<h3 id="time-travel-using-version-system-version-and-timestamp-system-time">Time Travel using VERSION (SYSTEM_VERSION) and TIMESTAMP (SYSTEM_TIME)<a class="headerlink" href="#time-travel-using-version-system-version-and-timestamp-system-time" title="Permalink to this heading">#</a></h3>
<p>Use the Iceberg connector to access the historical data of a table.
You can see how the table looked like at a certain point in time,
even if the data has changed or been deleted since then.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="mi">5300424205832769799</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">'united states'</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'comment'</span><span class="p">);</span>

<span class="o">//</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="mi">6891257133877048303</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="s1">'canada'</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">'comment'</span><span class="p">);</span>

<span class="o">//</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="mi">705548372863208787</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="s1">'mexico'</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">'comment'</span><span class="p">);</span>

<span class="o">//</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="n">record</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">VERSION</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="mi">5300424205832769799</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">SYSTEM_VERSION</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">SYSTEM_VERSION</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="mi">5300424205832769799</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> nationkey |      name     | regionkey | comment
-----------+---------------+-----------+---------
        10 | united states |         1 | comment
(1 row)
</pre></div>
</div>
<p>In above example, SYSTEM_VERSION can be used as an alias for VERSION.</p>
<p>You can access the historical data of a table using FOR TIMESTAMP AS OF TIMESTAMP.
The query returns the tableâ€™s state using the table snapshot that is closest to the specified timestamp.
In this example, SYSTEM_TIME can be used as an alias for TIMESTAMP.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="w"> </span><span class="k">In</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="k">second</span><span class="w"> </span><span class="n">inserted</span><span class="w"> </span><span class="n">record</span><span class="p">.</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="s1">'2023-10-17 13:29:46.822 America/Los_Angeles'</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">Same</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">SYSTEM_TIME</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="k">alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">SYSTEM_TIME</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="s1">'2023-10-17 13:29:46.822 America/Los_Angeles'</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> nationkey |      name     | regionkey | comment
-----------+---------------+-----------+---------
        10 | united states |         1 | comment
        20 | canada        |         2 | comment
(2 rows)
</pre></div>
</div>
<p>The option following FOR TIMESTAMP AS OF can accept any expression that returns a timestamp with time zone value.
For example, <cite>TIMESTAMP â€˜2023-10-17 13:29:46.822 America/Los_Angelesâ€™</cite> is a constant string for the expression.
In the following query, the expression CURRENT_TIMESTAMP returns the current timestamp with time zone value.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ctas_nation</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> nationkey |      name     | regionkey | comment
-----------+---------------+-----------+---------
        10 | united states |         1 | comment
        20 | canada        |         2 | comment
        30 | mexico        |         3 | comment
(3 rows)
</pre></div>
</div>
</section>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="hudi.html" title="Hudi connector"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Hudi connector </span>
              </div>
            </a>
          
          
            <a href="jmx.html" title="JMX Connector"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> JMX Connector </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright The Presto Foundation. All rights reserved. Presto is a registered trademark of LF Projects, LLC.
              
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>